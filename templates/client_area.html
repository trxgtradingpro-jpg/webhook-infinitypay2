<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minha Conta | TRX PRO</title>
  <link rel="shortcut icon" href="/favicon.ico?v=4" type="image/x-icon">
  <link rel="icon" href="/assets/favicons/trx_bull_exact_16.png?v=4" type="image/png" sizes="16x16">
  <link rel="icon" href="/assets/favicons/trx_bull_exact_32.png?v=4" type="image/png" sizes="32x32">
  <link rel="icon" href="/assets/favicons/trx_bull_exact_64.png?v=4" type="image/png" sizes="64x64">
  <link rel="apple-touch-icon" href="/assets/favicons/trx_bull_exact_256.png?v=4">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#05070a;
      --bg2:#070b12;
      --txt:#eef6ff;
      --muted:rgba(238,246,255,.68);
      --muted2:rgba(238,246,255,.55);
      --line:rgba(255,255,255,.12);
      --line2:rgba(255,255,255,.18);
      --green:#23b00b;
      --green2:#1d8f09;
      --red:#ff3a3a;
      --blue:#4aa3ff;
      --warn:#ffd21a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--txt);
      background:
        radial-gradient(1100px 650px at 20% 8%, rgba(35,176,11,.18), transparent 58%),
        radial-gradient(900px 600px at 80% 18%, rgba(255,138,31,.12), transparent 62%),
        radial-gradient(900px 700px at 60% 86%, rgba(168,85,247,.10), transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 50%, var(--bg) 100%);
      overflow-x:hidden;
    }
    .grid-bg{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.16;
      background:
        linear-gradient(to right, rgba(255,255,255,.09) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.09) 1px, transparent 1px);
      background-size:64px 64px;
      mask-image:radial-gradient(circle at 50% 18%, rgba(0,0,0,1) 0%, rgba(0,0,0,.65) 45%, rgba(0,0,0,0) 76%);
    }
    .vignette{
      position:fixed; inset:-40px;
      pointer-events:none;
      background:radial-gradient(circle at 50% 22%, transparent 0%, rgba(0,0,0,.35) 55%, rgba(0,0,0,.75) 90%);
    }
    .aurora-bg{
      position:fixed;
      inset:-18%;
      pointer-events:none;
      overflow:hidden;
      z-index:0;
      opacity:.78;
      filter:saturate(1.08);
    }
    .aurora-blob{
      position:absolute;
      width:min(62vw, 820px);
      min-width:320px;
      aspect-ratio:1/1;
      border-radius:999px;
      filter:blur(92px);
      mix-blend-mode:screen;
      opacity:.26;
      transform:translate3d(0,0,0);
      will-change:transform;
    }
    .aurora-blob.a{
      top:-16%;
      left:-8%;
      background:radial-gradient(circle at 36% 34%, rgba(35,176,11,.46), rgba(35,176,11,.12) 50%, transparent 74%);
      animation:auroraDriftA 24s ease-in-out infinite alternate;
    }
    .aurora-blob.b{
      top:8%;
      right:-22%;
      background:radial-gradient(circle at 44% 40%, rgba(74,163,255,.42), rgba(74,163,255,.12) 52%, transparent 76%);
      animation:auroraDriftB 30s ease-in-out infinite alternate;
      animation-delay:-7s;
    }
    .aurora-blob.c{
      bottom:-24%;
      left:18%;
      background:radial-gradient(circle at 50% 44%, rgba(255,138,31,.34), rgba(240,90,26,.09) 50%, transparent 76%);
      animation:auroraDriftC 34s ease-in-out infinite alternate;
      animation-delay:-12s;
    }
    @keyframes auroraDriftA{
      0%{ transform:translate3d(-4%, -1%, 0) scale(1); }
      50%{ transform:translate3d(8%, -6%, 0) scale(1.08); }
      100%{ transform:translate3d(-2%, 9%, 0) scale(.96); }
    }
    @keyframes auroraDriftB{
      0%{ transform:translate3d(1%, -3%, 0) scale(.98); }
      50%{ transform:translate3d(-8%, 6%, 0) scale(1.10); }
      100%{ transform:translate3d(5%, -2%, 0) scale(.95); }
    }
    @keyframes auroraDriftC{
      0%{ transform:translate3d(0, 3%, 0) scale(1); }
      50%{ transform:translate3d(-7%, -7%, 0) scale(1.07); }
      100%{ transform:translate3d(6%, 5%, 0) scale(.94); }
    }
    @media (prefers-reduced-motion: reduce){
      .aurora-blob{
        animation:none !important;
        opacity:.18;
      }
    }
    .wrap{
      position:relative;
      z-index:2;
      width:min(1180px, 93vw);
      margin:24px auto 36px;
      display:grid;
      gap:16px;
    }
    .top{
      position:relative;
      overflow:visible;
      z-index:40;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:14px;
      flex-wrap:wrap;
      padding:16px 18px;
      border-radius:20px;
      border:1px solid rgba(179,210,255,.18);
      background:linear-gradient(180deg, rgba(9,16,26,.94), rgba(6,11,20,.96));
      box-shadow:0 26px 70px rgba(0,0,0,.42), inset 0 1px 0 rgba(255,255,255,.06);
    }
    .top::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius:inherit;
      background:radial-gradient(820px 220px at 10% 0%, rgba(74,163,255,.18), transparent 62%);
      pointer-events:none;
    }
    .title{
      display:flex;
      align-items:center;
      gap:12px;
      font-size:clamp(30px, 3.1vw, 46px);
      letter-spacing:-1px;
      font-weight:1000;
      margin:0;
      text-transform:uppercase;
      line-height:.95;
    }
    .title-logo{
      width:54px;
      height:54px;
      object-fit:contain;
      border:1px solid rgba(255,255,255,.52);
      border-radius:10px;
      background:rgba(5,10,16,.46);
      padding:4px;
      display:block;
      pointer-events:none;
      user-select:none;
      -webkit-user-drag:none;
      filter:drop-shadow(0 10px 20px rgba(0,0,0,.42));
    }
    .subtitle{
      margin:8px 0 0;
      color:rgba(218,231,249,.86);
      font-size:clamp(14px, 1.1vw, 18px);
      font-weight:800;
      letter-spacing:-.3px;
    }
    .section-anchor{
      scroll-margin-top:100px;
    }
    .account-menu{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      border:1px solid rgba(165,198,242,.20);
      border-radius:14px;
      padding:10px;
      background:linear-gradient(180deg, rgba(8,14,24,.88), rgba(5,9,16,.92));
      box-shadow:inset 0 1px 0 rgba(255,255,255,.05), 0 12px 30px rgba(0,0,0,.24);
    }
    .account-menu a{
      border:1px solid rgba(104,170,255,.44);
      border-radius:999px;
      padding:8px 12px;
      font-size:13px;
      font-weight:900;
      color:#dcebff;
      text-decoration:none;
      letter-spacing:.15px;
      background:linear-gradient(180deg, rgba(17,33,56,.90), rgba(10,20,34,.92));
      transition:.16s transform, .16s filter, .16s border-color;
    }
    .account-menu a:hover{
      transform:translateY(-1px);
      filter:brightness(1.08);
      border-color:rgba(35,176,11,.58);
    }
    .account-menu a.is-active{
      border-color:rgba(35,176,11,.70);
      background:linear-gradient(180deg, rgba(20,78,52,.92), rgba(12,52,35,.92));
      color:#d8ffe8;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.14), 0 8px 20px rgba(20,97,72,.25);
    }
    .section-anchor.is-hidden{
      display:none !important;
    }
    .top-actions{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }
    .notif-wrap{
      position:relative;
      z-index:80;
    }
    .notif-btn{
      position:relative;
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid rgba(106,175,255,.56);
      border-radius:14px;
      background:linear-gradient(180deg, rgba(18,36,62,.98), rgba(10,21,38,.98));
      color:#eaf4ff;
      font-weight:900;
      letter-spacing:.2px;
      padding:10px 14px;
      cursor:pointer;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.13), 0 12px 28px rgba(0,0,0,.28);
      transition:.16s transform, .16s filter, .16s border-color;
    }
    .notif-btn:hover{
      transform:translateY(-1px);
      filter:brightness(1.07);
      border-color:rgba(120,210,255,.8);
    }
    .notif-btn[aria-expanded="true"]{
      border-color:rgba(35,176,11,.72);
      box-shadow:0 0 0 2px rgba(35,176,11,.22), inset 0 1px 0 rgba(255,255,255,.12), 0 10px 24px rgba(0,0,0,.24);
    }
    .notif-ic{
      font-size:17px;
      line-height:1;
    }
    .notif-text{
      font-size:13px;
      text-transform:uppercase;
    }
    .notif-badge{
      min-width:22px;
      height:22px;
      border-radius:999px;
      display:inline-grid;
      place-items:center;
      padding:0 6px;
      font-size:12px;
      font-weight:1000;
      color:#150702;
      background:linear-gradient(180deg, #ffb347, #ff7a18);
      border:1px solid rgba(255,255,255,.28);
      box-shadow:0 6px 14px rgba(255,122,24,.42);
    }
    .notif-panel{
      position:absolute;
      right:0;
      top:calc(100% + 10px);
      width:min(420px, 90vw);
      max-height:min(68vh, 520px);
      overflow:hidden;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background:linear-gradient(180deg, rgba(8,14,24,.98), rgba(5,10,18,.98));
      box-shadow:0 28px 82px rgba(0,0,0,.56);
      z-index:120;
      opacity:0;
      pointer-events:none;
      transform:translateY(6px) scale(.98);
      transition:.16s ease;
    }
    .notif-panel.open{
      opacity:1;
      pointer-events:auto;
      transform:translateY(0) scale(1);
    }
    .notif-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding:11px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      font-size:12px;
      font-weight:900;
      color:#eaf4ff;
      letter-spacing:.2px;
      text-transform:uppercase;
    }
    .notif-list{
      max-height:calc(min(68vh, 520px) - 42px);
      overflow:auto;
      display:grid;
      gap:8px;
      padding:8px;
    }
    .notif-item{
      border-radius:11px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.03);
      padding:10px;
      display:grid;
      gap:6px;
    }
    .notif-item.warn{
      border-color:rgba(255,138,31,.44);
      background:linear-gradient(180deg, rgba(55,28,7,.42), rgba(35,20,6,.38));
    }
    .notif-item.info{
      border-color:rgba(74,163,255,.44);
      background:linear-gradient(180deg, rgba(18,37,63,.36), rgba(13,28,47,.30));
    }
    .notif-title{
      margin:0;
      font-size:13px;
      font-weight:900;
      color:#f3f8ff;
    }
    .notif-desc{
      margin:0;
      font-size:12px;
      font-weight:700;
      color:rgba(230,241,255,.78);
      line-height:1.38;
    }
    .notif-action{
      width:fit-content;
      border:1px solid rgba(35,176,11,.52);
      border-radius:999px;
      padding:6px 10px;
      color:#c8ffdf;
      background:rgba(35,176,11,.14);
      text-decoration:none;
      font-size:11px;
      font-weight:900;
      letter-spacing:.2px;
      text-transform:uppercase;
      transition:.16s transform, .16s filter;
    }
    .notif-action:hover{
      transform:translateY(-1px);
      filter:brightness(1.08);
    }
    .notif-empty{
      margin:0;
      font-size:12px;
      font-weight:700;
      color:var(--muted);
      padding:12px;
      text-align:center;
    }
    .msg{
      margin:0;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid var(--line);
      font-size:14px;
      line-height:1.4;
      background:rgba(255,255,255,.03);
      box-shadow:0 12px 30px rgba(0,0,0,.18);
    }
    .msg.ok{
      border-color:rgba(35,176,11,.42);
      background:rgba(35,176,11,.12);
      color:#b9ffd3;
    }
    .msg.warn{
      border-color:rgba(255,138,31,.46);
      background:linear-gradient(180deg, rgba(78,42,12,.36), rgba(56,30,8,.34));
      color:#ffe0bd;
    }
    .msg a{
      color:#fff0cf;
      font-weight:900;
      text-decoration:none;
      border-bottom:1px dashed rgba(255,240,207,.55);
    }
    .msg a:hover{
      filter:brightness(1.08);
    }
    .diagnostic-prompt{
      border:1px solid rgba(255,166,0,.46);
      border-radius:16px;
      padding:14px;
      display:grid;
      gap:10px;
      background:linear-gradient(180deg, rgba(78,42,12,.42), rgba(56,30,8,.38));
      box-shadow:0 14px 32px rgba(0,0,0,.22);
    }
    .diagnostic-prompt.is-minimized{
      border-style:dashed;
      padding:11px 12px;
      background:linear-gradient(180deg, rgba(56,30,8,.34), rgba(36,22,12,.32));
    }
    .diagnostic-prompt.is-minimized .diagnostic-prompt-content,
    .diagnostic-prompt.is-minimized .diagnostic-actions{
      display:none;
    }
    .diagnostic-prompt-content{
      display:grid;
      gap:8px;
    }
    .diagnostic-pill{
      margin:0;
      width:fit-content;
      border:1px solid rgba(255,166,0,.62);
      border-radius:999px;
      padding:5px 10px;
      font-size:11px;
      font-weight:1000;
      letter-spacing:.28px;
      color:#ffe4b8;
      background:rgba(255,166,0,.16);
      text-transform:uppercase;
    }
    .diagnostic-prompt-content h2{
      margin:0;
      font-size:clamp(20px, 2.1vw, 30px);
      line-height:1.05;
      letter-spacing:-.5px;
      font-weight:1000;
      color:#fff1d7;
    }
    .diagnostic-prompt-content p{
      margin:0;
      font-size:14px;
      line-height:1.42;
      color:#ffe7c8;
      font-weight:700;
    }
    .diagnostic-note{
      color:#ffd6a0 !important;
      font-size:13px !important;
      font-weight:900 !important;
    }
    .diagnostic-actions{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .diagnostic-btn{
      border:1px solid rgba(255,255,255,.26);
      border-radius:12px;
      text-decoration:none;
      cursor:pointer;
      font-size:13px;
      font-weight:1000;
      letter-spacing:.18px;
      padding:10px 14px;
      transition:.16s transform, .16s filter, .16s border-color;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-height:42px;
    }
    .diagnostic-btn:hover{
      transform:translateY(-1px);
      filter:brightness(1.06);
    }
    .diagnostic-btn.primary{
      border-color:rgba(255,166,0,.74);
      background:linear-gradient(180deg, rgba(255,173,37,.98), rgba(245,119,17,.98));
      color:#2a1300;
      box-shadow:0 10px 22px rgba(245,119,17,.30), inset 0 1px 0 rgba(255,255,255,.34);
    }
    .diagnostic-btn.ghost{
      background:rgba(255,255,255,.06);
      color:#ffe6c7;
    }
    .diagnostic-later-msg{
      margin:0;
      color:#ffe6c7;
      font-size:13px;
      line-height:1.4;
      font-weight:800;
    }
    html[data-theme="light"] .diagnostic-prompt{
      border-color:rgba(194,65,12,.42) !important;
      background:linear-gradient(180deg, rgba(255,231,204,.88), rgba(255,219,179,.80)) !important;
      box-shadow:0 12px 24px rgba(15,23,42,.10) !important;
    }
    html[data-theme="light"] .diagnostic-prompt.is-minimized{
      background:linear-gradient(180deg, rgba(255,237,213,.78), rgba(255,225,184,.72)) !important;
    }
    html[data-theme="light"] .diagnostic-pill{
      border-color:rgba(194,65,12,.52) !important;
      background:rgba(251,146,60,.14) !important;
      color:#9a3412 !important;
    }
    html[data-theme="light"] .diagnostic-prompt-content h2{
      color:#7c2d12 !important;
    }
    html[data-theme="light"] .diagnostic-prompt-content p{
      color:#9a3412 !important;
    }
    html[data-theme="light"] .diagnostic-note{
      color:#b45309 !important;
    }
    html[data-theme="light"] .diagnostic-btn.ghost{
      border-color:rgba(124,45,18,.28) !important;
      color:#7c2d12 !important;
      background:rgba(255,255,255,.58) !important;
    }
    html[data-theme="light"] .diagnostic-later-msg{
      color:#7c2d12 !important;
    }
    .logout{
      border:1px solid rgba(255,86,86,.62);
      border-radius:14px;
      background:linear-gradient(180deg, rgba(255,58,58,.30), rgba(255,58,58,.14));
      color:#ffd4d4;
      font-weight:900;
      letter-spacing:.2px;
      padding:10px 16px;
      cursor:pointer;
      transition:.16s transform, .16s filter;
    }
    .logout:hover{ transform:translateY(-1px); filter:brightness(1.1); }
    @media (max-width: 620px){
      .account-menu{
        gap:8px;
        padding:8px;
      }
      .account-menu a{
        font-size:12px;
        padding:7px 10px;
      }
      .top-actions{
        width:100%;
        justify-content:space-between;
      }
      .notif-text{
        display:none;
      }
      .notif-panel{
        right:-6px;
        width:min(380px, calc(100vw - 26px));
      }
      .title-logo{
        width:42px;
        height:42px;
      }
      .subtitle{
        font-size:18px;
      }
    }
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:16px;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns:1fr; }
    }
    .card{
      position:relative;
      overflow:hidden;
      border-radius:20px;
      border:1px solid rgba(182,208,244,.16);
      background:linear-gradient(180deg, rgba(9,15,24,.93), rgba(6,10,18,.95));
      box-shadow:0 24px 70px rgba(0,0,0,.40), inset 0 1px 0 rgba(255,255,255,.05);
      padding:18px;
      transition:.2s transform, .2s border-color, .2s box-shadow;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:radial-gradient(760px 220px at 12% 0%, rgba(35,176,11,.10), transparent 62%);
      pointer-events:none;
    }
    .card:hover{
      transform:translateY(-2px);
      border-color:rgba(120,178,255,.24);
      box-shadow:0 30px 82px rgba(0,0,0,.46), inset 0 1px 0 rgba(255,255,255,.05);
    }
    .card > *{
      position:relative;
      z-index:1;
    }
    h2{
      margin:0 0 12px;
      font-size:clamp(22px, 1.6vw, 28px);
      letter-spacing:-.8px;
      font-weight:900;
      line-height:1.02;
    }
    .ic{
      display:inline-flex;
      width:1.12em;
      align-items:center;
      justify-content:center;
      margin-right:6px;
      filter:drop-shadow(0 2px 6px rgba(0,0,0,.30));
      vertical-align:-1px;
    }
    .line{
      margin:9px 0;
      color:#dbe7ff;
      font-size:clamp(15px, 1vw, 17px);
      font-weight:700;
      display:flex;
      align-items:flex-start;
      gap:8px;
      flex-wrap:wrap;
      letter-spacing:-.2px;
      line-height:1.1;
    }
    .line span{
      color:rgba(220,232,247,.76);
      display:inline-block;
      min-width:150px;
      font-weight:800;
      font-size:clamp(13px, .9vw, 14px);
      letter-spacing:-.2px;
    }
    .line.line-compact span{
      min-width:0;
      margin-right:4px;
    }
    .kpi{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .card-wide{
      grid-column:1 / -1;
    }
    .summary-capital-card{
      display:grid;
      gap:10px;
    }
    .summary-capital-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:10px;
      flex-wrap:wrap;
    }
    .summary-capital-head .line{
      margin:0;
    }
    .summary-chart-wrap{
      margin-top:0;
      height:320px;
    }
    .summary-chart-note{
      margin:0;
      color:rgba(212,226,244,.70);
      font-size:13px;
      line-height:1.35;
      font-weight:800;
    }
    .summary-chart-note a{
      color:#9ed8ff;
      font-weight:900;
      text-decoration:none;
      border-bottom:1px dashed rgba(158,216,255,.58);
    }
    .summary-chart-note a:hover{
      filter:brightness(1.08);
    }
    .summary-grid{
      margin-top:10px;
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));
      gap:10px;
    }
    .summary-item{
      border:1px solid rgba(178,204,235,.24);
      border-radius:12px;
      padding:10px;
      background:rgba(255,255,255,.03);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
      display:grid;
      gap:6px;
    }
    .summary-item .s-label{
      color:rgba(220,232,247,.76);
      font-size:11px;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.25px;
    }
    .summary-item .s-value{
      color:#eef6ff;
      font-size:17px;
      font-weight:1000;
      letter-spacing:-.2px;
      line-height:1.08;
    }
    .summary-item .s-value.ok{
      color:#9ff8c5;
    }
    .summary-item .s-value.warn{
      color:#ffdba0;
    }
    .summary-item .s-value.info{
      color:#9de8d9;
    }
    .onboarding-card{
      display:grid;
      gap:10px;
    }
    .onboarding-done-card{
      padding:12px 16px;
      min-height:auto;
    }
    .onboarding-done-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .onboarding-done-inner strong{
      font-size:15px;
      color:#c9ffd8;
      font-weight:1000;
      letter-spacing:.1px;
    }
    .onboarding-done-inner span{
      color:rgba(214,231,249,.82);
      font-size:13px;
      font-weight:800;
    }
    .onboarding-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .onboarding-head h2{
      margin:0;
    }
    .onboarding-progress-meta{
      margin:0;
      color:rgba(220,232,247,.78);
      font-size:13px;
      font-weight:900;
      letter-spacing:.1px;
    }
    .onboarding-copy{
      margin:0;
      color:rgba(220,232,247,.72);
      font-size:13px;
      line-height:1.45;
      font-weight:700;
    }
    .onboarding-progress-row{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .onboarding-progress-bar{
      position:relative;
      flex:1 1 auto;
      height:10px;
      border-radius:999px;
      border:1px solid rgba(74,163,255,.34);
      background:rgba(255,255,255,.08);
      overflow:hidden;
    }
    .onboarding-progress-fill{
      position:absolute;
      inset:0 auto 0 0;
      width:0%;
      border-radius:inherit;
      background:linear-gradient(90deg, rgba(35,176,11,.92), rgba(74,163,255,.86));
      box-shadow:0 8px 20px rgba(35,176,11,.26);
      transition:width .2s ease;
    }
    .onboarding-progress-percent{
      min-width:50px;
      text-align:right;
      color:#e8f3ff;
      font-size:13px;
      font-weight:1000;
      letter-spacing:.2px;
    }
    .onboarding-step-indicators{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }
    .onboarding-step-dot{
      width:30px;
      height:7px;
      border-radius:999px;
      border:1px solid rgba(178,204,235,.24);
      background:rgba(255,255,255,.08);
      transition:.16s border-color, .16s background, .16s transform;
    }
    .onboarding-step-dot.is-done{
      border-color:rgba(35,176,11,.54);
      background:rgba(35,176,11,.78);
    }
    .onboarding-step-dot.is-active{
      border-color:rgba(255,166,0,.78);
      background:rgba(255,166,0,.46);
      transform:scaleX(1.12);
    }
    .onboarding-step-card{
      border:1px solid rgba(178,204,235,.22);
      border-radius:12px;
      background:rgba(255,255,255,.03);
      padding:12px;
      display:grid;
      gap:8px;
    }
    .onboarding-step-check{
      display:flex;
      align-items:flex-start;
      gap:10px;
      cursor:pointer;
    }
    .onboarding-step-check input{
      margin-top:2px;
      width:16px;
      height:16px;
      accent-color:#23b00b;
      flex:0 0 auto;
    }
    .onboarding-step-check span{
      color:#e6f1ff;
      font-size:15px;
      line-height:1.4;
      font-weight:900;
    }
    .onboarding-step-hint{
      margin:0;
      color:rgba(208,225,246,.74);
      font-size:12px;
      line-height:1.4;
      font-weight:800;
    }
    .onboarding-actions{
      display:flex;
      justify-content:flex-end;
      gap:8px;
      flex-wrap:wrap;
    }
    .onboarding-btn{
      border-radius:10px;
      border:1px solid rgba(104,170,255,.42);
      background:linear-gradient(180deg, rgba(16,33,59,.95), rgba(10,21,38,.96));
      color:#eaf4ff;
      font-size:12px;
      font-weight:1000;
      letter-spacing:.2px;
      text-transform:uppercase;
      padding:9px 12px;
      min-width:108px;
      cursor:pointer;
      transition:.16s transform, .16s filter, .16s border-color;
    }
    .onboarding-btn:hover{
      transform:translateY(-1px);
      filter:brightness(1.08);
    }
    .onboarding-btn[disabled]{
      opacity:.6;
      cursor:not-allowed;
      transform:none;
      filter:none;
    }
    .onboarding-btn.confirm{
      border-color:rgba(255,182,0,.68);
      background:linear-gradient(180deg, rgba(255,173,37,.98), rgba(245,119,17,.98));
      color:#2a1300;
      box-shadow:0 10px 22px rgba(245,119,17,.30), inset 0 1px 0 rgba(255,255,255,.34);
      animation:onboardingConfirmPulse 1.8s ease-in-out infinite;
    }
    @keyframes onboardingConfirmPulse{
      0%,100%{
        box-shadow:0 10px 22px rgba(245,119,17,.24), inset 0 1px 0 rgba(255,255,255,.34);
      }
      50%{
        box-shadow:0 14px 30px rgba(245,119,17,.38), inset 0 1px 0 rgba(255,255,255,.40);
      }
    }
    .onboarding-status{
      margin:0;
      color:rgba(208,225,246,.74);
      font-size:12px;
      line-height:1.4;
      font-weight:800;
      min-height:16px;
    }
    .onboarding-save-msg{
      margin:0;
      min-height:16px;
      color:#9ff8c5;
      font-size:12px;
      font-weight:900;
      letter-spacing:.1px;
    }
    .onboarding-save-msg.is-error{
      color:#ffb4b4;
    }
    html[data-theme="light"] .onboarding-done-inner strong{
      color:#166534 !important;
    }
    html[data-theme="light"] .onboarding-done-inner span{
      color:#334155 !important;
    }
    html[data-theme="light"] .onboarding-progress-meta{
      color:#334155 !important;
    }
    html[data-theme="light"] .onboarding-copy{
      color:#334155 !important;
    }
    html[data-theme="light"] .onboarding-progress-bar{
      border-color:rgba(15,23,42,.20) !important;
      background:rgba(15,23,42,.09) !important;
    }
    html[data-theme="light"] .onboarding-progress-percent{
      color:#0f172a !important;
    }
    html[data-theme="light"] .onboarding-step-dot{
      border-color:rgba(15,23,42,.24) !important;
      background:rgba(15,23,42,.10) !important;
    }
    html[data-theme="light"] .onboarding-step-dot.is-done{
      border-color:rgba(22,163,74,.48) !important;
      background:rgba(22,163,74,.72) !important;
    }
    html[data-theme="light"] .onboarding-step-dot.is-active{
      border-color:rgba(194,65,12,.74) !important;
      background:rgba(251,146,60,.52) !important;
    }
    html[data-theme="light"] .onboarding-step-card{
      border-color:rgba(15,23,42,.18) !important;
      background:rgba(15,23,42,.04) !important;
      box-shadow:none !important;
    }
    html[data-theme="light"] .onboarding-step-check span{
      color:#0f172a !important;
    }
    html[data-theme="light"] .onboarding-step-hint{
      color:#334155 !important;
    }
    html[data-theme="light"] .onboarding-status{
      color:#334155 !important;
    }
    html[data-theme="light"] .onboarding-save-msg{
      color:#166534 !important;
    }
    html[data-theme="light"] .onboarding-save-msg.is-error{
      color:#b91c1c !important;
    }
    @media (max-width: 640px){
      .onboarding-actions{
        justify-content:flex-start;
      }
      .onboarding-btn{
        min-width:100px;
      }
    }
    html[data-theme="light"] .summary-item{
      background:rgba(15,23,42,.04) !important;
      border-color:rgba(15,23,42,.18) !important;
      box-shadow:none !important;
    }
    html[data-theme="light"] .summary-item .s-label{
      color:#334155 !important;
    }
    html[data-theme="light"] .summary-item .s-value{
      color:#0f172a !important;
    }
    html[data-theme="light"] .summary-item .s-value.ok{
      color:#166534 !important;
    }
    html[data-theme="light"] .summary-item .s-value.warn{
      color:#b45309 !important;
    }
    html[data-theme="light"] .summary-item .s-value.info{
      color:#0f766e !important;
    }
    .chart-wrap{
      width:100%;
      height:390px;
      margin-top:14px;
      position:relative;
      border:1px solid rgba(194,216,248,.18);
      border-radius:16px;
      padding:10px;
      background:linear-gradient(180deg, rgba(7,12,20,.88), rgba(4,8,14,.92));
      box-shadow:inset 0 1px 0 rgba(255,255,255,.05);
    }
    .install-sub{
      margin:0;
      color:rgba(220,233,249,.74);
      font-size:14px;
      font-weight:700;
      line-height:1.45;
    }
    .support-grid{
      margin-top:12px;
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
      gap:10px;
    }
    .support-item{
      border:1px solid rgba(178,204,235,.24);
      border-radius:14px;
      padding:12px;
      background:rgba(255,255,255,.03);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
      display:grid;
      gap:8px;
      align-content:start;
    }
    .support-item h3{
      margin:0;
      font-size:15px;
      font-weight:1000;
      color:#edf5ff;
      letter-spacing:-.2px;
    }
    .support-item p{
      margin:0;
      color:rgba(220,232,247,.72);
      font-size:13px;
      line-height:1.4;
      font-weight:700;
    }
    .support-item .affiliate-activate{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
    }
    .support-note{
      margin:10px 0 0;
      color:rgba(212,226,244,.68);
      font-size:12px;
      line-height:1.4;
      font-weight:800;
    }
    .install-video-wrap{
      margin-top:12px;
      border:1px solid rgba(177,205,244,.18);
      border-radius:16px;
      padding:8px;
      background:linear-gradient(180deg, rgba(7,12,20,.90), rgba(4,8,14,.94));
      box-shadow:inset 0 1px 0 rgba(255,255,255,.04), 0 14px 36px rgba(0,0,0,.28);
    }
    .install-video{
      position:relative;
      width:100%;
      aspect-ratio:16/9;
      border-radius:12px;
      overflow:hidden;
      background:#000;
    }
    .install-video iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
      opacity:0;
      transition:opacity .24s ease;
    }
    .install-video.is-ready iframe{
      opacity:1;
    }
    .chart-hint{
      margin-top:12px;
      color:rgba(212,226,244,.58);
      font-size:13px;
      line-height:1.4;
      font-weight:800;
    }
    .chart-window-controls{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .chart-config-row{
      margin-top:12px;
      display:flex;
      gap:12px;
      justify-content:space-between;
      align-items:stretch;
      flex-wrap:wrap;
      border:1px solid rgba(94,157,239,.26);
      border-radius:16px;
      padding:12px;
      background:linear-gradient(180deg, rgba(14,24,40,.58), rgba(9,17,30,.52));
      box-shadow:inset 0 1px 0 rgba(255,255,255,.07), 0 10px 28px rgba(0,0,0,.22);
    }
    .chart-config-row .chart-window-controls{
      margin-top:0;
      flex:1 1 440px;
    }
    .chart-editable-note{
      margin:0 0 10px;
      font-size:13px;
      font-weight:800;
      color:#c7defd;
    }
    .chart-contract-control{
      display:grid;
      gap:8px;
      min-width:250px;
      padding:10px 12px;
      border:1px solid rgba(35,176,11,.36);
      border-radius:14px;
      background:linear-gradient(180deg, rgba(12,26,22,.64), rgba(8,18,16,.52));
      box-shadow:inset 0 1px 0 rgba(255,255,255,.05);
    }
    .chart-contract-control label{
      font-size:13px;
      font-weight:900;
      color:#d7ecff;
      letter-spacing:.2px;
      text-transform:none;
    }
    .chart-contract-input-wrap{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .chart-contract-input{
      width:112px;
      border:1px solid rgba(74,163,255,.58);
      border-radius:12px;
      background:linear-gradient(180deg, rgba(9,18,33,.95), rgba(7,14,25,.95));
      color:#f2f8ff;
      padding:9px 10px;
      font-size:22px;
      font-weight:900;
      outline:none;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.08), 0 8px 18px rgba(0,0,0,.24);
      transition:.16s border-color, .16s box-shadow, .16s filter, .16s transform;
    }
    .chart-contract-input:hover{
      filter:brightness(1.08);
      transform:translateY(-1px);
    }
    .chart-contract-input:focus{
      border-color:rgba(35,176,11,.78);
      box-shadow:0 0 0 2px rgba(35,176,11,.22), 0 10px 20px rgba(20,97,72,.28);
      transform:translateY(0);
    }
    .chart-contract-input[disabled]{
      opacity:.65;
      cursor:not-allowed;
    }
    .chart-contract-limit{
      border:1px solid rgba(35,176,11,.52);
      border-radius:999px;
      padding:6px 10px;
      background:rgba(35,176,11,.22);
      color:#d9ffe8;
      font-size:12px;
      font-weight:900;
      letter-spacing:.2px;
      text-transform:uppercase;
    }
    .chart-mode-btn{
      border:1px solid rgba(100,166,255,.58);
      border-radius:999px;
      background:linear-gradient(180deg, rgba(16,33,59,.96), rgba(10,21,38,.96));
      color:#f0f6ff;
      padding:10px 16px;
      font-size:16px;
      font-weight:900;
      letter-spacing:.2px;
      cursor:pointer;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.10), 0 10px 22px rgba(0,0,0,.25);
      transition:.16s transform, .16s filter, .16s border-color, .16s box-shadow;
    }
    .chart-mode-btn:hover{
      transform:translateY(-2px);
      filter:brightness(1.08);
      border-color:rgba(120,210,255,.78);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.12), 0 12px 22px rgba(24,86,158,.28);
    }
    .chart-mode-btn.is-active{
      border-color:rgba(35,176,11,.74);
      background:linear-gradient(180deg, rgba(22,77,52,.90), rgba(15,53,36,.92));
      color:#c9ffd8;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.16), 0 12px 24px rgba(20,97,72,.32);
    }
    .pill{
      border:1px solid rgba(178,204,235,.24);
      border-radius:999px;
      padding:8px 12px;
      background:rgba(255,255,255,.03);
      color:#e3efff;
      font-size:13px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .pill.ok{
      border-color:rgba(35,176,11,.50);
      background:rgba(35,176,11,.15);
      color:#b9ffd3;
    }
    .pill.warn{
      border-color:rgba(255,210,26,.55);
      background:rgba(255,210,26,.14);
      color:#ffe79b;
    }
    .pill strong{
      color:#f2f8ff;
      font-size:inherit;
    }
    .pill.total-emphasis{
      position:relative;
      overflow:hidden;
      border-color:rgba(35,176,11,.78);
      background:linear-gradient(180deg, rgba(19,84,54,.46), rgba(10,42,29,.48));
      color:#d8ffe9;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.16), 0 10px 24px rgba(20,97,72,.28);
      animation: totalPillPulse 2.2s ease-in-out infinite;
    }
    .pill.total-emphasis::before{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(160px 52px at 18% 0%, rgba(133,255,204,.28), transparent 70%);
      pointer-events:none;
    }
    .pill.total-emphasis strong{
      position:relative;
      z-index:1;
      display:inline-block;
      color:#effff6;
      font-size:13px;
      letter-spacing:.15px;
      transition:transform .28s ease, filter .28s ease;
    }
    .pill.total-emphasis strong.is-pulsing{
      transform:scale(1.05);
      filter:brightness(1.08);
    }
    @keyframes totalPillPulse{
      0%,100%{
        box-shadow:inset 0 1px 0 rgba(255,255,255,.16), 0 10px 24px rgba(20,97,72,.26);
      }
      50%{
        box-shadow:inset 0 1px 0 rgba(255,255,255,.18), 0 14px 30px rgba(20,97,72,.40);
      }
    }
    @media (prefers-reduced-motion: reduce){
      .pill.total-emphasis{
        animation:none;
      }
    }
    .pill.bad{
      border-color:rgba(255,58,58,.52);
      background:rgba(255,58,58,.14);
      color:#ffd4d4;
    }
    .table-wrap{
      overflow-x:auto;
      border:1px solid rgba(188,212,246,.16);
      border-radius:14px;
      background:linear-gradient(180deg, rgba(8,14,24,.78), rgba(5,9,16,.88));
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width:860px;
    }
    th,td{
      padding:13px 12px;
      text-align:left;
      border-bottom:1px solid rgba(255,255,255,.08);
      font-size:14px;
      font-weight:700;
    }
    th{
      color:var(--muted);
      font-weight:900;
      background:rgba(255,255,255,.04);
      letter-spacing:.2px;
      font-size:14px;
      text-transform:uppercase;
    }
    tbody tr:hover{
      background:rgba(255,255,255,.03);
    }
    td strong{
      font-size:13px;
    }
    .status{
      display:inline-block;
      border-radius:999px;
      padding:5px 8px;
      font-size:11px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .status.ok{
      color:#bbf7d0;
      background:rgba(35,176,11,.18);
      border:1px solid rgba(35,176,11,.42);
    }
    .status.bad{
      color:#ffd2d2;
      background:rgba(255,58,58,.18);
      border:1px solid rgba(255,58,58,.42);
    }
    .empty{
      color:var(--muted);
      font-size:14px;
      line-height:1.5;
      font-weight:700;
    }
    .back{
      width:fit-content;
      color:#eaf4ff;
      text-decoration:none;
      font-size:14px;
      font-weight:900;
      border:1px solid rgba(106,175,255,.40);
      background:linear-gradient(180deg, rgba(16,33,59,.94), rgba(11,21,37,.94));
      border-radius:14px;
      padding:10px 14px;
      transition:.16s transform, .16s filter;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.12), 0 12px 26px rgba(0,0,0,.24);
    }
    .back:hover{ transform:translateY(-1px); filter:brightness(1.08); border-color:rgba(139,197,255,.72); }
    .affiliate-intro{
      margin:0;
      color:#dbe7ff;
      font-size:15px;
      line-height:1.5;
      font-weight:700;
    }
    .affiliate-box{
      margin-top:12px;
      border:1px solid rgba(74,163,255,.34);
      border-radius:14px;
      padding:12px;
      background:linear-gradient(180deg, rgba(13,24,40,.56), rgba(9,17,30,.48));
      box-shadow:inset 0 1px 0 rgba(255,255,255,.06), 0 10px 24px rgba(0,0,0,.20);
      display:grid;
      gap:10px;
    }
    .affiliate-status-row{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .affiliate-status-text{
      color:#d8e7ff;
      font-size:14px;
      font-weight:800;
    }
    .affiliate-link-row{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .affiliate-link-field{
      flex:1 1 360px;
      min-width:220px;
      border:1px solid rgba(74,163,255,.48);
      border-radius:12px;
      background:linear-gradient(180deg, rgba(8,15,27,.95), rgba(6,12,21,.95));
      color:#ecf4ff;
      padding:10px 12px;
      font-size:13px;
      font-weight:800;
      letter-spacing:.1px;
    }
    .affiliate-link-copy,
    .affiliate-activate{
      border:1px solid rgba(255,210,26,.52);
      border-radius:12px;
      background:linear-gradient(180deg, rgba(255,164,51,.96), rgba(236,113,16,.96));
      color:#241000;
      padding:10px 14px;
      font-size:13px;
      font-weight:1000;
      letter-spacing:.2px;
      cursor:pointer;
      text-transform:uppercase;
      box-shadow:0 12px 24px rgba(236,113,16,.30), inset 0 1px 0 rgba(255,255,255,.30);
      transition:.16s transform, .16s filter;
    }
    .affiliate-link-copy:hover,
    .affiliate-activate:hover{
      transform:translateY(-1px);
      filter:brightness(1.08);
    }
    .affiliate-copy-wrap{
      position:relative;
      display:inline-flex;
      align-items:center;
    }
    .affiliate-copy-wrap.is-locked .affiliate-link-copy{
      opacity:.84;
      cursor:not-allowed;
    }
    .affiliate-copy-tooltip{
      position:absolute;
      left:50%;
      bottom:calc(100% + 10px);
      transform:translateX(-50%) translateY(6px);
      width:min(360px, 84vw);
      border-radius:12px;
      border:1px solid rgba(255,106,106,.44);
      background:linear-gradient(180deg, rgba(28,12,20,.96), rgba(18,8,15,.98));
      box-shadow:0 16px 32px rgba(0,0,0,.35);
      padding:10px 12px;
      color:#ffd5d9;
      font-size:12px;
      line-height:1.4;
      font-weight:800;
      opacity:0;
      pointer-events:none;
      transition:opacity .16s ease, transform .16s ease;
      z-index:12;
    }
    .affiliate-copy-tooltip::after{
      content:"";
      position:absolute;
      left:50%;
      top:100%;
      transform:translateX(-50%);
      border-width:7px 7px 0 7px;
      border-style:solid;
      border-color:rgba(28,12,20,.98) transparent transparent transparent;
    }
    .affiliate-copy-tooltip strong{
      font-weight:1000;
    }
    .affiliate-copy-tooltip ul{
      margin:6px 0 0;
      padding-left:18px;
      display:grid;
      gap:4px;
    }
    .affiliate-copy-wrap.is-locked:hover .affiliate-copy-tooltip,
    .affiliate-copy-wrap.is-locked:focus-within .affiliate-copy-tooltip,
    .affiliate-copy-wrap.is-locked.show-tooltip .affiliate-copy-tooltip{
      opacity:1;
      transform:translateX(-50%) translateY(0);
    }
    .affiliate-muted{
      margin:0;
      color:var(--muted2);
      font-size:13px;
      line-height:1.45;
      font-weight:700;
    }
    .affiliate-rules{
      margin:0;
      padding-left:18px;
      display:grid;
      gap:8px;
      color:#dce9ff;
      font-size:13px;
      line-height:1.45;
      font-weight:700;
    }
    .affiliate-rules li{
      margin:0;
    }
    .affiliate-rules strong{
      color:#fff3c6;
      font-weight:900;
    }
    .affiliate-note{
      margin:0;
      padding:10px 11px;
      border-radius:10px;
      border:1px solid rgba(255,210,26,.30);
      background:linear-gradient(180deg, rgba(255,210,26,.12), rgba(255,138,31,.10));
      color:#ffe7be;
      font-size:12px;
      line-height:1.45;
      font-weight:800;
    }
    .affiliate-link-copy[disabled],
    .affiliate-activate[disabled]{
      opacity:.75;
      cursor:not-allowed;
      transform:none;
      filter:none;
    }
    .affiliate-copy-hint{
      margin:0;
      border-radius:10px;
      padding:10px 11px;
      font-size:12px;
      line-height:1.45;
      font-weight:800;
    }
    .affiliate-copy-hint.warn{
      border:1px solid rgba(255,106,106,.34);
      background:linear-gradient(180deg, rgba(255,106,106,.12), rgba(160,26,42,.14));
      color:#ffd5d9;
    }
    .affiliate-copy-hint.ok{
      border:1px solid rgba(35,176,11,.34);
      background:linear-gradient(180deg, rgba(35,176,11,.12), rgba(29,143,9,.14));
      color:#cfffd2;
    }
    .affiliate-copy-hint strong{
      font-weight:1000;
    }
    .affiliate-copy-hint ul{
      margin:6px 0 0;
      padding-left:18px;
      display:grid;
      gap:4px;
    }
    .affiliate-form{
      display:grid;
      gap:10px;
      margin:0;
    }
    .affiliate-pref-form{
      border:1px solid rgba(74,163,255,.30);
      border-radius:12px;
      padding:10px;
      background:rgba(255,255,255,.02);
    }
    .affiliate-pref-label{
      margin:0;
      color:#dce9ff;
      font-size:13px;
      font-weight:900;
      letter-spacing:.1px;
    }
    .affiliate-pref-options{
      display:grid;
      grid-template-columns:repeat(2, minmax(0, 1fr));
      gap:8px;
    }
    .affiliate-pref-option{
      display:flex;
      align-items:flex-start;
      gap:8px;
      border:1px solid rgba(178,204,235,.24);
      border-radius:10px;
      background:rgba(255,255,255,.03);
      padding:9px 10px;
      cursor:pointer;
      transition:.16s border-color, .16s background;
    }
    .affiliate-pref-option:hover{
      border-color:rgba(35,176,11,.44);
      background:rgba(35,176,11,.08);
    }
    .affiliate-pref-option input{
      width:15px;
      height:15px;
      margin-top:2px;
      accent-color:#23b00b;
      flex:0 0 auto;
    }
    .affiliate-pref-option span{
      color:#e6f1ff;
      font-size:12px;
      line-height:1.35;
      font-weight:800;
    }
    @media (max-width: 760px){
      .affiliate-pref-options{
        grid-template-columns:1fr;
      }
    }
    html[data-theme="light"] .affiliate-pref-form{
      border-color:rgba(15,23,42,.18) !important;
      background:rgba(15,23,42,.03) !important;
    }
    html[data-theme="light"] .affiliate-pref-label{
      color:#0f172a !important;
    }
    html[data-theme="light"] .affiliate-pref-option{
      border-color:rgba(15,23,42,.18) !important;
      background:rgba(255,255,255,.72) !important;
    }
    html[data-theme="light"] .affiliate-pref-option span{
      color:#0f172a !important;
    }
    html[data-theme="light"] .affiliate-pref-option:hover{
      border-color:rgba(22,163,74,.42) !important;
      background:rgba(22,163,74,.10) !important;
    }
    .affiliate-terms-check{
      display:flex;
      align-items:flex-start;
      gap:8px;
      margin:0;
      cursor:pointer;
    }
    .affiliate-terms-check input{
      width:16px;
      height:16px;
      margin-top:2px;
      accent-color:#23b00b;
      flex:0 0 auto;
    }
    .affiliate-terms-check span{
      color:#e7f0ff;
      font-size:13px;
      line-height:1.4;
      font-weight:700;
    }
    .affiliate-terms-check a{
      color:#9ed8ff;
      font-weight:900;
      text-decoration:none;
    }
    .affiliate-terms-check a:hover{
      text-decoration:underline;
    }
    .affiliate-edit-label{
      display:block;
      color:#dce9ff;
      font-size:13px;
      font-weight:900;
      letter-spacing:.1px;
    }
    .affiliate-slug-field{
      flex:1 1 220px;
      min-width:180px;
      text-transform:lowercase;
    }
    .affiliate-slug-hint{
      margin:0;
      color:var(--muted2);
      font-size:12px;
      line-height:1.4;
      font-weight:700;
    }
    .affiliate-terms-cta{
      border-color:rgba(35,176,11,.52);
      background:linear-gradient(180deg, rgba(35,176,11,.96), rgba(29,143,9,.96));
      color:#03150f;
      width:fit-content;
      min-width:220px;
      justify-self:center;
      padding:10px 20px;
      box-shadow:0 12px 24px rgba(35,176,11,.30), inset 0 1px 0 rgba(255,255,255,.30);
    }
    .upsell-intro{
      margin:0;
      color:#dbe7ff;
      font-size:16px;
      line-height:1.5;
      font-weight:700;
    }
    .upsell-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(240px, 1fr));
      gap:14px;
      margin-top:14px;
    }
    .upsell-card{
      --card-border:rgba(74,163,255,.44);
      --card-top:rgba(11,20,40,.96);
      --card-bottom:rgba(8,14,30,.98);
      --card-shine:rgba(74,163,255,.16);
      --card-tag-bg:rgba(74,163,255,.16);
      --card-tag-border:rgba(74,163,255,.52);
      --card-tag-color:#c9ecff;
      --card-price:#ecf2ff;
      --card-cta:#90ffd4;
      position:relative;
      overflow:hidden;
      display:block;
      border:1px solid var(--card-border);
      border-radius:16px;
      padding:14px;
      text-decoration:none;
      background:linear-gradient(180deg, var(--card-top), var(--card-bottom));
      color:#ecf3ff;
      transition:transform .16s ease, border-color .16s ease, box-shadow .16s ease, filter .16s ease;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.08), 0 14px 34px rgba(0,0,0,.28);
      min-height:240px;
    }
    .upsell-card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:radial-gradient(420px 170px at 10% 0%, var(--card-shine), transparent 68%);
      pointer-events:none;
      opacity:.95;
    }
    .upsell-card > *{
      position:relative;
      z-index:1;
    }
    .upsell-card:hover{
      transform:translateY(-2px);
      filter:brightness(1.05);
      border-color:rgba(116,199,255,.66);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.10), 0 14px 34px rgba(25,86,160,.30);
    }
    .upsell-card.plan-bronze{
      --card-border:rgba(255,138,31,.52);
      --card-top:rgba(36,18,4,.96);
      --card-bottom:rgba(21,11,3,.98);
      --card-shine:rgba(255,138,31,.20);
      --card-tag-bg:rgba(255,138,31,.18);
      --card-tag-border:rgba(255,138,31,.48);
      --card-tag-color:#ffd4b0;
      --card-price:#ffbc67;
    }
    .upsell-card.plan-prata{
      --card-border:rgba(198,212,235,.52);
      --card-top:rgba(22,30,46,.96);
      --card-bottom:rgba(12,18,30,.98);
      --card-shine:rgba(198,212,235,.18);
      --card-tag-bg:rgba(198,212,235,.18);
      --card-tag-border:rgba(198,212,235,.50);
      --card-tag-color:#deebff;
      --card-price:#dbe6f6;
    }
    .upsell-card.plan-gold{
      --card-border:rgba(255,210,26,.52);
      --card-top:rgba(36,27,4,.96);
      --card-bottom:rgba(19,13,2,.98);
      --card-shine:rgba(255,210,26,.18);
      --card-tag-bg:rgba(255,210,26,.18);
      --card-tag-border:rgba(255,210,26,.52);
      --card-tag-color:#ffe89a;
      --card-price:#ffe26a;
    }
    .upsell-card.plan-black{
      --card-border:rgba(207,164,255,.52);
      --card-top:rgba(28,12,46,.96);
      --card-bottom:rgba(16,6,28,.98);
      --card-shine:rgba(207,164,255,.20);
      --card-tag-bg:rgba(207,164,255,.17);
      --card-tag-border:rgba(207,164,255,.52);
      --card-tag-color:#e6d0ff;
      --card-price:#ddc0ff;
    }
    .upsell-card.recommended{
      border-color:rgba(35,176,11,.66);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.10), 0 14px 36px rgba(20,97,72,.34);
    }
    .upsell-card.recommended::after{
      content:"";
      position:absolute;
      inset:auto -18% -42% -18%;
      height:68%;
      background:radial-gradient(440px 170px at 50% 0%, rgba(35,176,11,.22), transparent 74%);
      pointer-events:none;
    }
    .upsell-card .tag{
      display:inline-block;
      margin-bottom:8px;
      border-radius:999px;
      padding:4px 10px;
      font-size:11px;
      font-weight:900;
      background:var(--card-tag-bg);
      border:1px solid var(--card-tag-border);
      color:var(--card-tag-color);
      letter-spacing:.2px;
      text-transform:uppercase;
    }
    .upsell-card.recommended .tag{
      background:rgba(35,176,11,.18);
      border-color:rgba(35,176,11,.52);
      color:#bbf7d0;
    }
    .upsell-name{
      margin:0;
      font-size:24px;
      font-weight:1000;
      line-height:.92;
      letter-spacing:-.8px;
      text-transform:uppercase;
    }
    .upsell-contracts{
      margin:6px 0 0;
      font-size:13px;
      font-weight:800;
      color:#c9daef;
      letter-spacing:.2px;
      text-transform:uppercase;
    }
    .upsell-price{
      margin:14px 0 0;
      font-size:48px;
      font-weight:1000;
      line-height:.92;
      letter-spacing:-.9px;
      color:var(--card-price);
    }
    .upsell-price .rs{
      font-size:24px;
      margin-right:2px;
    }
    .upsell-price small{
      font-size:14px;
      color:#d9e6fa;
      font-weight:800;
      margin-left:4px;
      letter-spacing:.1px;
    }
    .upsell-cta{
      margin-top:12px;
      font-size:14px;
      font-weight:900;
      color:var(--card-cta);
      letter-spacing:.2px;
      text-transform:uppercase;
    }
    .upsell-note{
      margin-top:12px;
      color:var(--muted2);
      font-size:15px;
      font-weight:700;
    }
    @media (max-width: 980px){
      .chart-wrap{
        height:350px;
      }
      .upsell-price{
        font-size:42px;
      }
      .upsell-price small{
        font-size:13px;
      }
    }
    @media (max-width: 760px){
      .line{
        font-size:16px;
      }
      .line span{
        min-width:0;
        width:100%;
      }
      .pill{
        font-size:13px;
      }
      .chart-mode-btn{
        font-size:14px;
      }
      .chart-contract-control{
        min-width:100%;
      }
      .upsell-name{
        font-size:22px;
      }
      .upsell-contracts{
        font-size:12px;
      }
      .upsell-price{
        font-size:36px;
      }
      .upsell-price small{
        font-size:12px;
      }
      .upsell-cta{
        font-size:14px;
      }
      .upsell-note{
        font-size:13px;
      }
    }
  </style>
</head>
<body>
  <div class="aurora-bg" aria-hidden="true">
    <span class="aurora-blob a"></span>
    <span class="aurora-blob b"></span>
    <span class="aurora-blob c"></span>
  </div>
  <div class="grid-bg" aria-hidden="true"></div>
  <div class="vignette" aria-hidden="true"></div>
  <main class="wrap">
    <header class="top">
      <div>
        <h1 class="title">
          <img class="title-logo" src="/assets/favicons/trx_bull_exact_256.png?v=5" alt="TRX PRO" draggable="false">
          <span>Minha Conta TRX PRO</span>
        </h1>
        <p class="subtitle">Bem-vindo, {{ conta_nome or 'Cliente' }}.</p>
      </div>
      <div class="top-actions">
        <div class="notif-wrap" id="notifWrap">
          <button
            id="notifToggleBtn"
            class="notif-btn"
            type="button"
            aria-label="Abrir notificaes"
            aria-expanded="false"
            aria-controls="notifPanel"
          >
            <span class="notif-ic" aria-hidden="true">&#128276;</span>
            <span class="notif-text">Notificaes</span>
            {% if notification_count > 0 %}
              <span class="notif-badge">{{ notification_count }}</span>
            {% endif %}
          </button>
          <aside id="notifPanel" class="notif-panel" aria-hidden="true">
            <div class="notif-head">
              <span>Notificaes</span>
              <span>{{ notification_count }}</span>
            </div>
            <div class="notif-list">
              {% if client_notifications %}
                {% for notif in client_notifications %}
                  <article class="notif-item {{ notif.level or 'info' }}">
                    <p class="notif-title">{{ notif.title }}</p>
                    <p class="notif-desc">{{ notif.message }}</p>
                    {% if notif.action_url %}
                      <a class="notif-action" href="{{ notif.action_url }}">{{ notif.action_label or 'Abrir' }}</a>
                    {% endif %}
                  </article>
                {% endfor %}
              {% else %}
                <p class="notif-empty">Sem notificaes novas.</p>
              {% endif %}
            </div>
          </aside>
        </div>
        <form method="POST" action="/logout">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
          <button class="logout" type="submit">Sair</button>
        </form>
      </div>
    </header>
    {% if info_message %}
      <div class="msg {{ info_message_level or 'ok' }}">{{ info_message }}</div>
    {% endif %}
    {% if not diagnostico_concluido %}
      <section class="diagnostic-prompt" id="diagnosticPromptCard" aria-live="polite">
        <div class="diagnostic-prompt-content">
          <p class="diagnostic-pill">Recomendao de plano pendente</p>
          <h2>Falta concluir seu Diagnstico de Perfil TRX</h2>
          <p>Esse diagnstico identifica seu perfil e recomenda o plano mais adequado para sua operao, evitando escolhas no escuro e acelerando sua configurao inicial.</p>
          <p class="diagnostic-note">Leva cerca de 1 minuto e ajuda voc a comear com mais clareza e segurana.</p>
        </div>
        <div class="diagnostic-actions">
          <a class="diagnostic-btn primary" href="/diagnostico-de-perfil-trx">Fazer diagnstico agora</a>
          <button class="diagnostic-btn ghost" id="diagnosticLaterBtn" type="button">Mais tarde</button>
        </div>
        <p class="diagnostic-later-msg" id="diagnosticLaterMsg" hidden>Sem problemas. Quando voc quiser, vai ser rapidinho concluir o diagnstico.</p>
      </section>
    {% endif %}

    <nav class="account-menu">
      <a href="#resumo">Resumo</a>
      <a href="#afiliados">Afiliados</a>
      <a href="#manual-instalacao">Manual de instalao</a>
      <a href="#contato-suporte">Contato e suporte</a>
      <a href="#capital">Curva de capital</a>
      {% if upsell_plans %}
      <a href="#upgrade">Upgrade</a>
      {% endif %}
      <a href="#historico">Histrico</a>
    </nav>

    <section class="grid section-anchor" id="resumo">
      <article class="card card-wide onboarding-card {{ 'onboarding-done-card' if onboarding_progress.percent >= 100 else '' }}" id="onboardingChecklistCard">
        <div id="onboardingFlowContent" {% if onboarding_progress.percent >= 100 %}hidden{% endif %}>
          <div class="onboarding-head">
            <h2>Checklist de ativao</h2>
            <p id="onboardingProgressMeta" class="onboarding-progress-meta">{{ onboarding_progress.done_count }}/{{ onboarding_progress.total_steps }} etapas concludas</p>
          </div>
          <p class="onboarding-copy">Avance etapa por etapa. Use <strong>Prosseguir</strong> e <strong>Voltar</strong>; na ltima, clique em <strong>Confirmar e salvar</strong>.</p>
          <div class="onboarding-progress-row">
            <div class="onboarding-progress-bar" aria-hidden="true">
              <span id="onboardingProgressFill" class="onboarding-progress-fill" style="width: {{ onboarding_progress.percent }}%;"></span>
            </div>
            <span id="onboardingProgressPercent" class="onboarding-progress-percent">{{ onboarding_progress.percent }}%</span>
          </div>
          <div class="onboarding-step-indicators" id="onboardingStepIndicators" aria-hidden="true"></div>
          <div class="onboarding-step-card">
            <label class="onboarding-step-check" for="onboardingCurrentStepCheckbox">
              <input type="checkbox" id="onboardingCurrentStepCheckbox" data-step-key="">
              <span id="onboardingCurrentStepLabel">Etapa de ativao</span>
            </label>
            <p id="onboardingCurrentStepHint" class="onboarding-step-hint"></p>
          </div>
          <div class="onboarding-actions">
            <button type="button" class="onboarding-btn" id="onboardingPrevBtn">Voltar</button>
            <button type="button" class="onboarding-btn" id="onboardingNextBtn">Prosseguir</button>
            <button type="button" class="onboarding-btn confirm" id="onboardingConfirmBtn">Confirmar e salvar</button>
          </div>
          <p id="onboardingStatusText" class="onboarding-status"></p>
          <p id="onboardingSaveMsg" class="onboarding-save-msg" aria-live="polite"></p>
        </div>
        <div id="onboardingDoneContent" class="onboarding-done-inner" {% if onboarding_progress.percent < 100 %}hidden{% endif %}>
          <strong id="onboardingDoneTitle">Checklist de ativao concludo.</strong>
          <span id="onboardingDoneMeta">{{ onboarding_progress.done_count }}/{{ onboarding_progress.total_steps }} etapas confirmadas. Sua rea est pronta para uso.</span>
        </div>
        <script type="application/json" id="onboardingStepsJson">{{ onboarding_progress.steps|tojson }}</script>
      </article>

      <article class="card">
        <h2>Dados do cliente</h2>
        <p class="line"><span>Nome:</span> {{ conta_nome or '-' }}</p>
        <p class="line"><span>E-mail:</span> {{ email }}</p>
        <p class="line"><span>Telefone:</span> {{ conta.telefone or '-' }}</p>
        <p class="line"><span>Conta criada:</span> {{ conta.created_at.strftime("%d/%m/%Y %H:%M") if conta.created_at else '-' }}</p>
      </article>

      <article class="card">
        <h2>Status dos planos</h2>
        <div class="kpi">
          <span class="pill">Total liberado: {{ pedidos|length }}</span>
          <span class="pill ok">Ativos: {{ ativos|length }}</span>
          <span class="pill warn">Expirados: {{ (pedidos|length) - (ativos|length) }}</span>
        </div>
        {% if ultimo_pedido %}
          <p class="line line-compact" style="margin-top:10px;"><span>Plano mais recente:</span> <strong>{{ ultimo_pedido.plano_nome }}</strong></p>
          <p class="line"><span>Expira em:</span> {{ ultimo_pedido.expira_em_fmt }}</p>
        {% else %}
          <p class="empty">Nenhum plano encontrado para este e-mail.</p>
        {% endif %}
      </article>

      <article class="card card-wide summary-capital-card">
        <div class="summary-capital-head">
          <h2>Curva de capital</h2>
          {% if capital_chart and capital_chart.available %}
            <p class="line line-compact"><span>Plano:</span> <strong>{{ capital_chart.plan_name }}</strong></p>
          {% endif %}
        </div>
        {% if capital_chart and capital_chart.available %}
          <div class="chart-wrap summary-chart-wrap">
            <canvas id="capitalChartResumo"></canvas>
          </div>
          <p class="summary-chart-note">
            Visual rpido no resumo. Para ajustar janela e contratos, acesse a aba <a href="#capital">Curva de capital</a>.
          </p>
        {% else %}
          <p class="empty">{{ capital_chart.message if capital_chart else 'Curva indisponvel no momento.' }}</p>
        {% endif %}
      </article>

      <article class="card card-wide">
        <h2>Resumo geral de tudo</h2>
        <div class="summary-grid">
          <div class="summary-item">
            <span class="s-label">Histrico total</span>
            <span class="s-value info">{{ pedidos|length }} registro(s)</span>
          </div>
          <div class="summary-item">
            <span class="s-label">Planos ativos</span>
            <span class="s-value {{ 'ok' if (ativos|length) > 0 else 'warn' }}">{{ ativos|length }}</span>
          </div>
          <div class="summary-item">
            <span class="s-label">Diagnstico de perfil</span>
            <span class="s-value {{ 'ok' if diagnostico_concluido else 'warn' }}">{{ 'Concludo' if diagnostico_concluido else 'Pendente' }}</span>
          </div>
          <div class="summary-item">
            <span class="s-label">Afiliao</span>
            <span class="s-value {{ 'ok' if afiliado_cliente and afiliado_cliente.ativo else 'warn' }}">
              {% if afiliado_cliente and afiliado_cliente.ativo %}Ativa{% elif afiliado_cliente %}Inativa{% else %}No ativa{% endif %}
            </span>
          </div>
          <div class="summary-item">
            <span class="s-label">Curva de capital</span>
            <span class="s-value {{ 'ok' if capital_chart and capital_chart.available else 'warn' }}">
              {% if capital_chart and capital_chart.available %}Disponvel{% else %}Indisponvel{% endif %}
            </span>
          </div>
          <div class="summary-item">
            <span class="s-label">Upgrade de planos</span>
            <span class="s-value {{ 'ok' if upsell_plans else 'warn' }}">
              {% if upsell_plans %}{{ upsell_plans|length }} opo(es){% else %}Sem sugestes{% endif %}
            </span>
          </div>
          <div class="summary-item">
            <span class="s-label">Notificaes</span>
            <span class="s-value {{ 'warn' if notification_count > 0 else 'ok' }}">{{ notification_count }}</span>
          </div>
          <div class="summary-item">
            <span class="s-label">ltimo plano</span>
            <span class="s-value info">{{ ultimo_pedido.plano_nome if ultimo_pedido else 'Nenhum' }}</span>
          </div>
        </div>
      </article>
    </section>

    <section class="card section-anchor" id="afiliados">
      <h2>Programa de afiliados</h2>
      <p class="affiliate-intro">
        Aqui voc pode ativar sua afiliao, gerar seu link de indicao e acompanhar uma regra clara de comissionamento.
      </p>
      <div class="affiliate-box">
        <ul class="affiliate-rules">
          <li><strong>Escolha de recebimento:</strong> voc define se prefere receber em <strong>dinheiro</strong> ou em <strong>plano</strong>.</li>
          <li><strong>Modo Dinheiro:</strong> {{ affiliate_commission_percent }}% do valor do plano pago adquirido pelo indicado.</li>
          <li><strong>Modo Plano:</strong> 1 m&ecirc;s gr&aacute;tis do mesmo plano comprado pelo indicado.</li>
          <li><strong>Primeiro indicador:</strong> o primeiro afiliado que indicar um e-mail fica vinculado de forma permanente.</li>
          <li><strong>Compra futura:</strong> se esse mesmo cliente comprar novamente depois, o beneficio continua para quem indicou primeiro.</li>
          <li><strong>Persistncia:</strong> os dados de indicao e comisso ficam registrados no banco com order_id, plano, checkout, valor pago e valor da comisso.</li>
        </ul>
        <p class="affiliate-note">
          Importante: o rastreio  feito por e-mail do comprador. Evite criar vrias contas para o mesmo cliente.
        </p>
        {% if afiliado_cliente %}
          <div class="affiliate-status-row">
            {% if afiliado_cliente.ativo %}
              <span class="status ok">Ativo</span>
            {% else %}
              <span class="status bad">Inativo</span>
            {% endif %}
            <span class="affiliate-status-text">Slug: <strong>{{ afiliado_cliente.slug }}</strong></span>
            <span class="affiliate-status-text">Recebimento: <strong>{{ afiliado_cliente.commission_preference_label }}</strong></span>
          </div>
          <form method="POST" action="/minha-conta/afiliados/preferencia-comissao" class="affiliate-form affiliate-pref-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <p class="affiliate-pref-label">Como voc quer receber sua indicao?</p>
            <div class="affiliate-pref-options">
              <label class="affiliate-pref-option">
                <input type="radio" name="commission_preference" value="dinheiro" {% if (afiliado_cliente.commission_preference or 'dinheiro') == 'dinheiro' %}checked{% endif %}>
                <span>Dinheiro: {{ affiliate_commission_percent }}% por plano pago do indicado.</span>
              </label>
              <label class="affiliate-pref-option">
                <input type="radio" name="commission_preference" value="plano" {% if (afiliado_cliente.commission_preference or 'dinheiro') == 'plano' %}checked{% endif %}>
                <span>Plano: 1 m&ecirc;s gr&aacute;tis no mesmo plano comprado pelo indicado.</span>
              </label>
            </div>
            <button type="submit" class="affiliate-activate">Salvar prefer&ecirc;ncia</button>
          </form>
          <div class="affiliate-link-row">
            <input
              id="affiliateLinkField"
              class="affiliate-link-field"
              type="text"
              value="{{ afiliado_cliente.link_publico }}"
              readonly
            >
            <div class="affiliate-copy-wrap {% if not affiliate_copy_ready %}is-locked{% endif %}" id="affiliateCopyWrap">
              <button
                type="button"
                id="affiliateCopyBtn"
                class="affiliate-link-copy"
                data-copy-ready="{{ '1' if affiliate_copy_ready else '0' }}"
                data-blocked-message="{% if affiliate_copy_pending_steps %}Falta: {{ affiliate_copy_pending_steps | join(' ') }}{% else %}Falta concluir a ativacao do afiliado.{% endif %}"
                {% if not affiliate_copy_ready %}aria-disabled="true"{% endif %}
              >Copiar link</button>
              {% if not affiliate_copy_ready %}
                <div class="affiliate-copy-tooltip" id="affiliateCopyTooltip" role="tooltip">
                  <strong>Para copiar seu link, falta:</strong>
                  <ul>
                    {% for step in affiliate_copy_pending_steps %}
                      <li>{{ step }}</li>
                    {% endfor %}
                  </ul>
                </div>
              {% endif %}
            </div>
          </div>
          {% if affiliate_copy_ready %}
            <p class="affiliate-copy-hint ok" id="affiliateCopyHint">Link liberado para c&oacute;pia.</p>
          {% endif %}
          <p class="affiliate-muted">
            Compartilhe este link: <a href="{{ afiliado_cliente.link_publico }}" target="_blank" rel="noopener noreferrer">{{ afiliado_cliente.link_publico }}</a>
          </p>
          <form method="POST" action="/minha-conta/afiliados/editar-link" class="affiliate-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <label for="affiliateSlugInput" class="affiliate-edit-label">Editar link de afiliado (slug)</label>
            <div class="affiliate-link-row">
              <input
                id="affiliateSlugInput"
                name="affiliate_slug"
                class="affiliate-link-field affiliate-slug-field"
                type="text"
                minlength="2"
                maxlength="60"
                pattern="[a-z0-9-]{2,60}"
                value="{{ afiliado_cliente.slug }}"
                required
              >
              <button type="submit" class="affiliate-activate">Salvar link</button>
            </div>
            <p class="affiliate-slug-hint">Use apenas letras min&uacute;sculas, n&uacute;meros e h&iacute;fen. Exemplo: guilherme-trx</p>
          </form>
          {% if not afiliado_cliente.ativo %}
            <form method="POST" action="/minha-conta/afiliados/ativar" class="affiliate-form">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <div class="affiliate-pref-options">
                <label class="affiliate-pref-option">
                  <input type="radio" name="commission_preference" value="dinheiro" {% if (afiliado_cliente.commission_preference or 'dinheiro') == 'dinheiro' %}checked{% endif %}>
                  <span>Dinheiro: {{ affiliate_commission_percent }}% por plano pago.</span>
                </label>
                <label class="affiliate-pref-option">
                  <input type="radio" name="commission_preference" value="plano" {% if (afiliado_cliente.commission_preference or 'dinheiro') == 'plano' %}checked{% endif %}>
                  <span>Plano: 1 ms grtis por indicado vlido.</span>
                </label>
              </div>
              <label class="affiliate-terms-check">
                <input type="checkbox" name="accept_affiliate_terms" value="1" required>
                <span>Li e aceito os <a href="/termos" target="_blank" rel="noopener noreferrer">Termos de Uso</a> e a <a href="/privacidade" target="_blank" rel="noopener noreferrer">Poltica de Privacidade</a> para liberar minha indicao.</span>
              </label>
              <button type="submit" class="affiliate-activate">Reativar afiliao</button>
            </form>
          {% elif not afiliado_cliente.terms_accepted %}
            <form method="POST" action="/minha-conta/afiliados/ativar" class="affiliate-form">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <div class="affiliate-pref-options">
                <label class="affiliate-pref-option">
                  <input type="radio" name="commission_preference" value="dinheiro" {% if (afiliado_cliente.commission_preference or 'dinheiro') == 'dinheiro' %}checked{% endif %}>
                  <span>Dinheiro: {{ affiliate_commission_percent }}% por plano pago.</span>
                </label>
                <label class="affiliate-pref-option">
                  <input type="radio" name="commission_preference" value="plano" {% if (afiliado_cliente.commission_preference or 'dinheiro') == 'plano' %}checked{% endif %}>
                  <span>Plano: 1 ms grtis por indicado vlido.</span>
                </label>
              </div>
              <label class="affiliate-terms-check">
                <input type="checkbox" name="accept_affiliate_terms" value="1" required>
                <span>Para manter a indicao liberada, confirme o aceite dos <a href="/termos" target="_blank" rel="noopener noreferrer">Termos de Uso</a> e da <a href="/privacidade" target="_blank" rel="noopener noreferrer">Poltica de Privacidade</a>.</span>
              </label>
              <button type="submit" class="affiliate-activate affiliate-terms-cta">Aceitar termos</button>
            </form>
          {% endif %}
        {% else %}
          <p class="affiliate-muted">
            Sua conta ainda no est afiliada. Ative abaixo e gere agora seu link de indicao.
          </p>
          <div class="affiliate-copy-hint warn">
            <strong>Para copiar seu link, falta:</strong>
            <ul>
              {% for step in affiliate_copy_pending_steps %}
                <li>{{ step }}</li>
              {% endfor %}
            </ul>
          </div>
          <form method="POST" action="/minha-conta/afiliados/ativar" class="affiliate-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <div class="affiliate-pref-options">
              <label class="affiliate-pref-option">
                <input type="radio" name="commission_preference" value="dinheiro" checked>
                <span>Dinheiro: {{ affiliate_commission_percent }}% por plano pago do indicado.</span>
              </label>
              <label class="affiliate-pref-option">
                <input type="radio" name="commission_preference" value="plano">
                <span>Plano: 1 ms grtis no mesmo plano do indicado.</span>
              </label>
            </div>
            <label class="affiliate-terms-check">
              <input type="checkbox" name="accept_affiliate_terms" value="1" required>
              <span>Li e aceito os <a href="/termos" target="_blank" rel="noopener noreferrer">Termos de Uso</a> e a <a href="/privacidade" target="_blank" rel="noopener noreferrer">Poltica de Privacidade</a> para liberar minha indicao.</span>
            </label>
            <button type="submit" class="affiliate-activate">Quero me afiliar</button>
          </form>
        {% endif %}
      </div>
    </section>

    <section class="card section-anchor" id="manual-instalacao">
      <h2>Manual de instalao</h2>
      <p class="install-sub">
        Siga o passo a passo no vdeo oficial para instalar e configurar o TRX PRO corretamente.
      </p>
      <div class="install-video-wrap">
        <div class="install-video" id="installVideo" data-video-id="{{ install_video_id }}" data-loaded="0">
          <iframe
            id="installVideoFrame"
            title="Manual de instalao TRX PRO"
            allow="autoplay; encrypted-media; picture-in-picture; fullscreen"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen
            loading="lazy"
          ></iframe>
        </div>
      </div>
    </section>

    <section class="card section-anchor" id="contato-suporte">
      <h2>Contato e suporte</h2>
      <p class="install-sub">
        Fale com o time TRX PRO para suporte tcnico, dvidas operacionais e atendimento comercial.
      </p>
      <div class="support-grid">
        <article class="support-item">
          <h3>WhatsApp oficial</h3>
          <p>Atendimento rpido para suporte e orientaes no dia a dia.</p>
          <a
            class="affiliate-activate"
            href="https://wa.me/5511940431906?text=Oi!%20Preciso%20de%20suporte%20na%20%C3%A1rea%20do%20cliente%20TRX%20PRO."
            target="_blank"
            rel="noopener noreferrer"
          >Falar no WhatsApp</a>
        </article>
        <article class="support-item">
          <h3>E-mail</h3>
          <p>Para assuntos administrativos e atendimento formal.</p>
          <a class="affiliate-activate" href="mailto:suporte@trxpro.com.br">Enviar e-mail</a>
        </article>
        <article class="support-item">
          <h3>Central de contato</h3>
          <p>Acesse a pgina de contato com os canais oficiais atualizados.</p>
          <a class="affiliate-activate" href="/contato">Abrir pgina de contato</a>
        </article>
      </div>
      <p class="support-note">Se possvel, informe seu e-mail de login para agilizar o atendimento.</p>
    </section>

    <section class="card section-anchor" id="capital">
      <h2>Crescimento do capital</h2>
      {% if capital_chart and capital_chart.available %}
        <p class="line"><span>Plano:</span> {{ capital_chart.plan_name }}</p>
        <p class="chart-editable-note">Ajustes do grfico: clique nos botes e altere a quantidade de contratos.</p>
        <div class="chart-config-row">
          {% if capital_chart.window_modes %}
          <div class="chart-window-controls">
            {% for mode_id, mode in capital_chart.window_modes.items() %}
              <button
              type="button"
              class="chart-mode-btn {{ 'is-active' if mode_id == (capital_chart.default_window_mode or 'forward30') else '' }}"
              data-chart-mode="{{ mode_id }}"
            >
              {{ mode.title }}
            </button>
            {% endfor %}
          </div>
          {% endif %}
          <div class="chart-contract-control">
            <label for="contractCountInput">Quantidade de contratos</label>
            <div class="chart-contract-input-wrap">
              <input
                id="contractCountInput"
                class="chart-contract-input"
                type="number"
                min="1"
                max="{{ capital_chart.contract_limit or 1 }}"
                step="1"
                value="{{ capital_chart.contract_default or 1 }}"
                {% if (capital_chart.contract_limit or 1) <= 1 %}disabled{% endif %}
              >
              <span class="chart-contract-limit">Limite: {{ capital_chart.contract_limit or 1 }}</span>
            </div>
          </div>
        </div>
        <div class="chart-wrap">
          <canvas id="capitalChart"></canvas>
        </div>
        <p class="chart-hint" id="chartHintText">Passe o mouse sobre a linha para ver a data e o valor do dia.</p>
      {% else %}
        <p class="empty">{{ capital_chart.message if capital_chart else 'Curva indisponvel no momento.' }}</p>
        <p class="empty">CSV esperado: <code>dia,pontos</code> (ex.: <code>1,600</code>, <code>2,-300</code>). Marcador opcional: <code>13,11260g</code>.</p>
      {% endif %}
    </section>

    {% if upsell_plans %}
    <section class="card section-anchor" id="upgrade">
      <h2>Evolua para um plano pago</h2>
      <p class="upsell-intro">
        Seu acesso gratuito est ativo. Para liberar mais recursos e suporte completo, escolha um plano abaixo.
      </p>
      <div class="upsell-grid">
        {% for plano in upsell_plans %}
          <a
            class="upsell-card js-upsell-link {{ plano.theme_class }} {{ 'recommended' if plano.is_most_chosen else '' }}"
            href="/checkout/{{ plano.checkout_slug }}"
            data-upgrade-plan="{{ plano.plano_id }}"
            data-upgrade-source="client_area_free_upsell"
          >
            <span class="tag">{{ plano.tag_text }}</span>
            <p class="upsell-name">{{ plano.nome }}</p>
            <p class="upsell-contracts">{{ plano.contracts_text }}</p>
            <p class="upsell-price">{{ plano.preco_fmt }}<small>/mes</small></p>
            <p class="upsell-cta">Comprar</p>
          </a>
        {% endfor %}
      </div>
      <p class="upsell-note">Ao clicar, voc ser direcionado para o checkout do plano selecionado.</p>
    </section>
    {% endif %}

    <section class="card section-anchor" id="historico">
      <h2>Histrico de acessos liberados</h2>
      {% if pedidos %}
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Pedido</th>
                <th>Plano</th>
                <th>Liberado em</th>
                <th>Expira em</th>
                <th>Status</th>
                <th>Dias restantes</th>
              </tr>
            </thead>
            <tbody>
              {% for p in pedidos %}
              <tr>
                <td><code>{{ p.order_id[:8] }}...</code></td>
                <td>
                  <strong>{{ p.plano_nome }}</strong><br>
                  <span style="color:#9db0d4;">{{ p.access_label or ('Pago' if p.is_paid else 'Gratuito') }}</span>
                </td>
                <td>{{ p.created_at_fmt }}</td>
                <td>{{ p.expira_em_fmt }}</td>
                <td>
                  {% if p.ativo %}
                    <span class="status ok">Ativo</span>
                  {% else %}
                    <span class="status bad">Expirado</span>
                  {% endif %}
                </td>
                <td>
                  {% if p.ativo %}
                    {{ p.dias_restantes }} dia(s)
                  {% else %}
                    0
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="empty">Ainda no encontramos planos ativos para esta conta.</p>
      {% endif %}
    </section>

    <a class="back" href="/">Voltar para a pgina inicial</a>
  </main>

  {% include "_shared_footer.html" %}

  {% if capital_chart and capital_chart.available %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      (function(){
        const payload = {{ capital_chart | tojson }};
        const canvas = document.getElementById("capitalChart");
        const summaryCanvas = document.getElementById("capitalChartResumo");
        if (!payload || !payload.available || !canvas) return;

        const fmtBRL = new Intl.NumberFormat("pt-BR", {
          style: "currency",
          currency: "BRL"
        });
        const curveLineColor = "rgb(32, 224, 120)";
        const curveFillColor = "rgba(32, 224, 120, 0.26)";
        const crosshairColor = "rgba(32, 224, 120, 0.82)";
        const windowModes = payload.window_modes || {};
        const fallbackModeData = {
          id: "fallback",
          title: "Janela atual",
          description: "",
          window_start_date: payload.window_start_date,
          window_end_date: payload.window_end_date,
          labels: payload.labels || [],
          date_labels: payload.date_labels || [],
          values: payload.values || [],
          daily_values: payload.daily_values || [],
          daily_points: payload.daily_points || [],
          y_min: payload.y_min,
          y_max: payload.y_max
        };
        const modeIds = Object.keys(windowModes);
        let activeMode = payload.default_window_mode;
        if (!activeMode || !windowModes[activeMode]) {
          activeMode = modeIds.length ? modeIds[0] : "fallback";
        }

        const modeButtons = Array.from(document.querySelectorAll(".chart-mode-btn[data-chart-mode]"));
        const windowRangeText = document.getElementById("windowRangeText");
        const chartHintText = document.getElementById("chartHintText");
        const contractsSelectedEl = document.getElementById("contractsSelected");
        const currentValueTextEl = document.getElementById("currentValueText");
        const csvTotalValueTextEl = document.getElementById("csvTotalValueText");
        const contractInput = document.getElementById("contractCountInput");
        const contractLimit = Math.max(1, Number.parseInt(payload.contract_limit || 1, 10) || 1);
        const axisPaddingBase = Math.max(0, Number(payload.axis_padding_base || 100));
        const prefersReducedMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
        let activeContracts = Math.max(1, Math.min(
          contractLimit,
          Number.parseInt(payload.contract_default || 1, 10) || 1
        ));

        function getModeData(modeId) {
          return windowModes[modeId] || fallbackModeData;
        }

        function roundTo2(value) {
          return Math.round((Number(value) + Number.EPSILON) * 100) / 100;
        }

        function normalizeContract(value) {
          const parsed = Number.parseInt(value, 10);
          if (!Number.isFinite(parsed)) return 1;
          return Math.max(1, Math.min(contractLimit, parsed));
        }

        function scaleValues(values) {
          return (values || []).map((value) => {
            if (value === null || value === undefined) {
              return null;
            }
            return roundTo2(Number(value) * activeContracts);
          });
        }

        function calculateYBounds(values) {
          const visibles = (values || []).filter((value) => Number.isFinite(value));
          const fallbackCurrent = roundTo2((Number(payload.current_value) || 0) * activeContracts);
          const baseValues = visibles.length ? visibles : [fallbackCurrent];
          const minimo = Math.min(...baseValues);
          const maximo = Math.max(...baseValues);
          const padding = axisPaddingBase * Math.max(1, activeContracts);

          let yMin = minimo - padding;
          let yMax = maximo + padding;

          if (Math.abs(yMax - yMin) < 0.01) {
            const fallbackPadding = padding || 100;
            yMin -= fallbackPadding;
            yMax += fallbackPadding;
          }

          return {
            y_min: roundTo2(yMin),
            y_max: roundTo2(yMax),
          };
        }

        function getScaledModeData(modeData) {
          const scaledValues = scaleValues(modeData.values || []);
          const scaledDailyValues = scaleValues(modeData.daily_values || []);
          const yBounds = calculateYBounds(scaledValues);
          return {
            ...modeData,
            values: scaledValues,
            daily_values: scaledDailyValues,
            daily_points: modeData.daily_points || [],
            y_min: yBounds.y_min,
            y_max: yBounds.y_max,
          };
        }

        function countVisibleValues(values) {
          return (values || []).filter((value) => Number.isFinite(value)).length;
        }

        function getPointRadius(values) {
          return countVisibleValues(values) <= 1 ? 4 : 0;
        }

        function animateCurrencyValue(targetEl, fromValue, toValue) {
          if (!targetEl) return;
          const nextValue = Number.isFinite(toValue) ? toValue : 0;
          const startValue = Number.isFinite(fromValue) ? fromValue : nextValue;

          if (prefersReducedMotion || Math.abs(nextValue - startValue) < 0.01) {
            targetEl.textContent = fmtBRL.format(nextValue);
            targetEl.dataset.currentValue = String(nextValue);
            targetEl.classList.remove("is-pulsing");
            return;
          }

          const duration = 560;
          const startedAt = performance.now();
          targetEl.classList.add("is-pulsing");

          function step(now) {
            const progress = Math.min(1, (now - startedAt) / duration);
            const eased = 1 - Math.pow(1 - progress, 3);
            const value = startValue + ((nextValue - startValue) * eased);
            targetEl.textContent = fmtBRL.format(value);

            if (progress < 1) {
              requestAnimationFrame(step);
              return;
            }

            targetEl.textContent = fmtBRL.format(nextValue);
            targetEl.dataset.currentValue = String(nextValue);
            setTimeout(() => targetEl.classList.remove("is-pulsing"), 180);
          }

          requestAnimationFrame(step);
        }

        function refreshContractIndicators() {
          if (contractsSelectedEl) {
            contractsSelectedEl.textContent = String(activeContracts);
          }
          if (currentValueTextEl) {
            const currentValue = (Number(payload.current_value) || 0) * activeContracts;
            currentValueTextEl.textContent = fmtBRL.format(currentValue);
          }
          if (csvTotalValueTextEl) {
            const csvTotalValue = (Number(payload.csv_total_value) || 0) * activeContracts;
            const previousValue = Number(csvTotalValueTextEl.dataset.currentValue);
            animateCurrencyValue(csvTotalValueTextEl, previousValue, csvTotalValue);
          }
          if (contractInput) {
            contractInput.value = String(activeContracts);
          }
        }

        function getHintText(modeData) {
          if (!modeData) {
            return "Passe o mouse sobre a linha para ver a data e o valor do dia.";
          }
          if (modeData.id === "forward30") {
            if (payload.marker_detected) {
              return "Janela de 30 dias posteriores. Mostra do incio do plano at o dia marcado com g no CSV (dia " + payload.marker_day + "). Contratos aplicados: " + activeContracts + ".";
            }
            return "Janela de 30 dias posteriores. Mostra do incio do plano at o ltimo dia atualizado. Contratos aplicados: " + activeContracts + ".";
          }
          if (modeData.id === "back30") {
            return "Janela de 30 dias anteriores. O dia atual fica no fim do grafico. Contratos aplicados: " + activeContracts + ".";
          }
          return "Janela da curva no periodo selecionado. Contratos aplicados: " + activeContracts + ".";
        }

        const initialModeData = getScaledModeData(getModeData(activeMode));
        const initialPointRadius = getPointRadius(initialModeData.values);
        let renderedModeData = initialModeData;

        const crosshairPlugin = {
          id: "crosshairPlugin",
          afterDatasetsDraw(chart) {
            const active = chart.tooltip && chart.tooltip.getActiveElements
              ? chart.tooltip.getActiveElements()
              : [];
            if (!active || !active.length) return;

            const ctx = chart.ctx;
            const area = chart.chartArea;
            const point = active[0].element;
            const x = point.x;
            const y = point.y;

            ctx.save();
            ctx.strokeStyle = crosshairColor;
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);

            ctx.beginPath();
            ctx.moveTo(x, area.top);
            ctx.lineTo(x, area.bottom);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(area.left, y);
            ctx.lineTo(area.right, y);
            ctx.stroke();
            ctx.restore();
          }
        };

        const chart = new Chart(canvas, {
          type: "line",
          data: {
            labels: initialModeData.labels || [],
            datasets: [{
              label: "Capital total (1 contrato)",
              data: initialModeData.values || [],
              borderColor: curveLineColor,
              backgroundColor: curveFillColor,
              fill: true,
              tension: 0,
              borderWidth: 2,
              pointRadius: initialPointRadius,
              pointHoverRadius: initialPointRadius > 0 ? 7 : 4,
              pointHitRadius: initialPointRadius > 0 ? 12 : 6,
              pointHoverBackgroundColor: curveLineColor,
              pointHoverBorderColor: "#0f2d24"
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              mode: "index",
              intersect: false
            },
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                displayColors: false,
                callbacks: {
                  title(items) {
                    if (!items || !items.length) return "";
                    const idx = items[0].dataIndex;
                    const modeData = renderedModeData || getModeData(activeMode);
                    const dateLabel = (modeData.date_labels || [])[idx] || "";
                    const dayLabel = (modeData.labels || [])[idx] || "";
                    return dateLabel + " (Dia " + dayLabel + ")";
                  },
                  label(context) {
                    const idx = context.dataIndex;
                    const valor = Number(context.parsed.y);
                    if (!Number.isFinite(valor)) {
                      return "Sem curva para esse dia.";
                    }
                    const sufixo = activeContracts > 1 ? "s" : "";
                    const lines = [];
                    const dailyValue = Number((renderedModeData.daily_values || [])[idx]);
                    const dailyPointsRaw = (renderedModeData.daily_points || [])[idx];

                    if (Number.isFinite(dailyValue)) {
                      if (payload.csv_value_mode === "points" && dailyPointsRaw !== null && dailyPointsRaw !== undefined && Number.isFinite(Number(dailyPointsRaw))) {
                        const dailyPointsNum = Number(dailyPointsRaw);
                        const dailyPointsText = Number.isInteger(dailyPointsNum)
                          ? String(dailyPointsNum)
                          : dailyPointsNum.toFixed(2).replace(".", ",");
                        const signedPoints = (dailyPointsNum > 0 ? "+" : "") + dailyPointsText;
                        lines.push("Resultado do dia: " + signedPoints + " pts (" + fmtBRL.format(dailyValue) + ")");
                      } else {
                        lines.push("Resultado do dia: " + fmtBRL.format(dailyValue));
                      }
                    }

                    lines.push("Capital total (" + activeContracts + " contrato" + sufixo + "): " + fmtBRL.format(valor));
                    return lines;
                  }
                }
              }
            },
            scales: {
              x: {
                grid: {
                  color: "rgba(120, 142, 184, 0.18)"
                },
                ticks: {
                  color: "#9db0d4",
                  maxTicksLimit: 10
                },
                title: {
                  display: true,
                  text: "Dias",
                  color: "#9db0d4"
                }
              },
              y: {
                min: initialModeData.y_min ?? payload.y_min,
                max: initialModeData.y_max ?? payload.y_max,
                grid: {
                  color: "rgba(120, 142, 184, 0.18)"
                },
                ticks: {
                  color: "#9db0d4",
                  callback(value) {
                    return fmtBRL.format(value);
                  }
                },
                title: {
                  display: true,
                  text: "Capital acumulado (R$)",
                  color: "#9db0d4"
                }
              }
            }
          },
          plugins: [crosshairPlugin]
        });
        let summaryChart = null;
        if (summaryCanvas) {
          summaryChart = new Chart(summaryCanvas, {
            type: "line",
            data: {
              labels: initialModeData.labels || [],
              datasets: [{
                label: "Capital total (1 contrato)",
                data: initialModeData.values || [],
                borderColor: curveLineColor,
                backgroundColor: curveFillColor,
                fill: true,
                tension: 0,
                borderWidth: 2,
                pointRadius: initialPointRadius,
                pointHoverRadius: initialPointRadius > 0 ? 6 : 4,
                pointHitRadius: initialPointRadius > 0 ? 10 : 6,
                pointHoverBackgroundColor: curveLineColor,
                pointHoverBorderColor: "#0f2d24"
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: {
                mode: "index",
                intersect: false
              },
              plugins: {
                legend: {
                  display: false
                },
                tooltip: {
                  displayColors: false,
                  callbacks: {
                    title(items) {
                      if (!items || !items.length) return "";
                      const idx = items[0].dataIndex;
                      const modeData = renderedModeData || getModeData(activeMode);
                      const dateLabel = (modeData.date_labels || [])[idx] || "";
                      const dayLabel = (modeData.labels || [])[idx] || "";
                      return dateLabel + " (Dia " + dayLabel + ")";
                    },
                    label(context) {
                      const valor = Number(context.parsed.y);
                      if (!Number.isFinite(valor)) {
                        return "Sem curva para esse dia.";
                      }
                      return "Capital total: " + fmtBRL.format(valor);
                    }
                  }
                }
              },
              scales: {
                x: {
                  grid: {
                    color: "rgba(120, 142, 184, 0.18)"
                  },
                  ticks: {
                    color: "#9db0d4",
                    maxTicksLimit: 10
                  },
                  title: {
                    display: true,
                    text: "Dias",
                    color: "#9db0d4"
                  }
                },
                y: {
                  min: initialModeData.y_min ?? payload.y_min,
                  max: initialModeData.y_max ?? payload.y_max,
                  grid: {
                    color: "rgba(120, 142, 184, 0.18)"
                  },
                  ticks: {
                    color: "#9db0d4",
                    callback(value) {
                      return fmtBRL.format(value);
                    }
                  },
                  title: {
                    display: true,
                    text: "Capital acumulado (R$)",
                    color: "#9db0d4"
                  }
                }
              }
            }
          });
        }

        function applyMode(modeId) {
          const modeData = getScaledModeData(getModeData(modeId));
          activeMode = modeId;
          renderedModeData = modeData;

          chart.data.labels = modeData.labels || [];
          chart.data.datasets[0].label = "Capital total (" + activeContracts + " contrato" + (activeContracts > 1 ? "s" : "") + ")";
          chart.data.datasets[0].data = modeData.values || [];
          const pointRadius = getPointRadius(modeData.values);
          chart.data.datasets[0].pointRadius = pointRadius;
          chart.data.datasets[0].pointHoverRadius = pointRadius > 0 ? 7 : 4;
          chart.data.datasets[0].pointHitRadius = pointRadius > 0 ? 12 : 6;
          chart.options.scales.y.min = modeData.y_min ?? payload.y_min;
          chart.options.scales.y.max = modeData.y_max ?? payload.y_max;
          chart.update();
          if (summaryChart) {
            summaryChart.data.labels = modeData.labels || [];
            summaryChart.data.datasets[0].label = "Capital total (" + activeContracts + " contrato" + (activeContracts > 1 ? "s" : "") + ")";
            summaryChart.data.datasets[0].data = modeData.values || [];
            summaryChart.data.datasets[0].pointRadius = pointRadius;
            summaryChart.data.datasets[0].pointHoverRadius = pointRadius > 0 ? 6 : 4;
            summaryChart.data.datasets[0].pointHitRadius = pointRadius > 0 ? 10 : 6;
            summaryChart.options.scales.y.min = modeData.y_min ?? payload.y_min;
            summaryChart.options.scales.y.max = modeData.y_max ?? payload.y_max;
            summaryChart.update();
          }

          if (windowRangeText) {
            const startDate = modeData.window_start_date || payload.window_start_date || payload.start_date || "";
            const endDate = modeData.window_end_date || payload.window_end_date || payload.end_date || "";
            windowRangeText.textContent = startDate + " at " + endDate;
          }
          if (chartHintText) {
            chartHintText.textContent = getHintText(modeData);
          }
          refreshContractIndicators();

          modeButtons.forEach((btn) => {
            btn.classList.toggle("is-active", (btn.getAttribute("data-chart-mode") || "") === modeId);
          });
        }

        modeButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const modeId = (btn.getAttribute("data-chart-mode") || "").trim();
            if (!modeId) return;
            applyMode(modeId);
          });
        });

        if (contractInput) {
          contractInput.addEventListener("change", () => {
            const nextContracts = normalizeContract(contractInput.value);
            if (nextContracts === activeContracts) {
              contractInput.value = String(activeContracts);
              return;
            }
            activeContracts = nextContracts;
            applyMode(activeMode);
          });

          contractInput.addEventListener("blur", () => {
            contractInput.value = String(normalizeContract(contractInput.value));
          });
        }

        refreshContractIndicators();
        applyMode(activeMode);
      })();
    </script>
  {% endif %}

  {% if upsell_plans %}
    <script>
      (function(){
        const links = document.querySelectorAll(".js-upsell-link[data-upgrade-plan]");
        if (!links.length) return;

        const csrfToken = "{{ csrf_token }}";
        const endpoint = "/api/client/lead-upgrade-click";

        function registrarLead(targetPlan, source){
          return fetch(endpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRF-Token": csrfToken
            },
            credentials: "same-origin",
            keepalive: true,
            body: JSON.stringify({
              target_plan: targetPlan,
              source: source || "client_area_free_upsell"
            })
          });
        }

        links.forEach((link) => {
          link.addEventListener("click", function(event){
            const targetPlan = link.getAttribute("data-upgrade-plan") || "";
            const source = link.getAttribute("data-upgrade-source") || "client_area_free_upsell";
            const href = link.getAttribute("href") || "/";

            if (!targetPlan) return;

            if (
              event.defaultPrevented ||
              event.button !== 0 ||
              event.metaKey ||
              event.ctrlKey ||
              event.shiftKey ||
              event.altKey
            ) {
              registrarLead(targetPlan, source).catch(() => null);
              return;
            }

            event.preventDefault();
            let redirected = false;
            const goCheckout = function(){
              if (redirected) return;
              redirected = true;
              window.location.href = href;
            };

            const fallback = setTimeout(goCheckout, 220);
            registrarLead(targetPlan, source)
              .catch(() => null)
              .finally(() => {
                clearTimeout(fallback);
                goCheckout();
              });
          });
        });
      })();
    </script>
  {% endif %}
  <script>
    (function setupAffiliateCopy(){
      const copyBtn = document.getElementById("affiliateCopyBtn");
      const field = document.getElementById("affiliateLinkField");
      const copyWrap = document.getElementById("affiliateCopyWrap");
      if (!copyBtn || !field) return;

      const originalLabel = copyBtn.textContent;
      const copyReady = copyBtn.getAttribute("data-copy-ready") === "1";
      let tooltipTimer = null;
      const setLabel = (text) => {
        copyBtn.textContent = text;
        setTimeout(() => {
          copyBtn.textContent = originalLabel;
        }, 1500);
      };
      const showTooltip = () => {
        if (!copyWrap || copyReady) return;
        copyWrap.classList.add("show-tooltip");
        clearTimeout(tooltipTimer);
        tooltipTimer = setTimeout(() => {
          copyWrap.classList.remove("show-tooltip");
        }, 2200);
      };

      copyBtn.addEventListener("click", async () => {
        if (!copyReady) {
          showTooltip();
          setLabel("Bloqueado");
          return;
        }

        const value = (field.value || "").trim();
        if (!value) return;

        try {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(value);
          } else {
            field.focus();
            field.select();
            document.execCommand("copy");
          }
          setLabel("Copiado");
        } catch (_) {
          setLabel("Falhou");
        }
      });
    })();
  </script>
  <script>
    (function setupOnboardingChecklist(){
      const card = document.getElementById("onboardingChecklistCard");
      if (!card) return;

      const flowContent = document.getElementById("onboardingFlowContent");
      const doneContent = document.getElementById("onboardingDoneContent");
      const doneTitleEl = document.getElementById("onboardingDoneTitle");
      const doneMetaEl = document.getElementById("onboardingDoneMeta");
      const stepsJsonEl = document.getElementById("onboardingStepsJson");
      if (!flowContent || !doneContent || !stepsJsonEl) return;

      let parsedSteps = [];
      try {
        parsedSteps = JSON.parse(stepsJsonEl.textContent || "[]");
      } catch (_) {
        parsedSteps = [];
      }

      const steps = Array.isArray(parsedSteps)
        ? parsedSteps
          .map((item) => ({
            key: String(item && item.key ? item.key : "").trim(),
            label: String(item && item.label ? item.label : "").trim(),
            checked: Boolean(item && item.checked)
          }))
          .filter((item) => item.key)
        : [];
      if (!steps.length) return;

      const progressMetaEl = document.getElementById("onboardingProgressMeta");
      const progressFillEl = document.getElementById("onboardingProgressFill");
      const progressPercentEl = document.getElementById("onboardingProgressPercent");
      const indicatorsEl = document.getElementById("onboardingStepIndicators");
      const currentStepCheckboxEl = document.getElementById("onboardingCurrentStepCheckbox");
      const currentStepLabelEl = document.getElementById("onboardingCurrentStepLabel");
      const currentStepHintEl = document.getElementById("onboardingCurrentStepHint");
      const prevBtn = document.getElementById("onboardingPrevBtn");
      const nextBtn = document.getElementById("onboardingNextBtn");
      const confirmBtn = document.getElementById("onboardingConfirmBtn");
      const statusEl = document.getElementById("onboardingStatusText");
      const saveMsgEl = document.getElementById("onboardingSaveMsg");
      if (
        !progressMetaEl ||
        !progressFillEl ||
        !progressPercentEl ||
        !indicatorsEl ||
        !currentStepCheckboxEl ||
        !currentStepLabelEl ||
        !currentStepHintEl ||
        !prevBtn ||
        !nextBtn ||
        !confirmBtn ||
        !statusEl ||
        !saveMsgEl
      ) return;

      const endpoint = "/api/client/onboarding-progress";
      const csrfToken = "{{ csrf_token }}";
      let saveSeq = 0;
      let isSaving = false;

      const stepState = {};
      steps.forEach((step) => {
        stepState[step.key] = Boolean(step.checked);
      });

      function getPayload(){
        const payload = {};
        steps.forEach((step) => {
          payload[step.key] = Boolean(stepState[step.key]);
        });
        return payload;
      }

      function getProgress(payload){
        const totalSteps = steps.length;
        const doneCount = steps.reduce((acc, step) => (payload[step.key] ? acc + 1 : acc), 0);
        const percent = totalSteps ? Math.round((doneCount * 100) / totalSteps) : 0;
        return { doneCount, totalSteps, percent };
      }

      function findCurrentStepIndex(payload){
        const firstPending = steps.findIndex((step) => !payload[step.key]);
        if (firstPending >= 0) return firstPending;
        return Math.max(steps.length - 1, 0);
      }

      let currentStepIndex = findCurrentStepIndex(stepState);
      const isInitiallyComplete = Boolean(flowContent.hidden);

      function setDoneSummary(doneCount, totalSteps){
        if (doneTitleEl) {
          doneTitleEl.textContent = "Checklist de ativao concludo.";
        }
        if (doneMetaEl) {
          doneMetaEl.textContent = doneCount + "/" + totalSteps + " etapas confirmadas. Sua rea j est pronta para operao.";
        }
      }

      function setCompletedView(isCompleted){
        card.classList.toggle("onboarding-done-card", isCompleted);
        flowContent.hidden = isCompleted;
        doneContent.hidden = !isCompleted;
      }

      function setSaveMessage(message, isError){
        saveMsgEl.textContent = message || "";
        saveMsgEl.classList.toggle("is-error", Boolean(isError));
      }

      function getStatusMessage(doneCount, totalSteps){
        if (doneCount <= 0) return "Marque a etapa atual para iniciar a ativacao.";
        if (doneCount >= totalSteps) return "Tudo marcado. Clique em Confirmar e salvar para finalizar.";
        return "Etapa " + (currentStepIndex + 1) + " de " + totalSteps + ". Avance com Prosseguir ou Voltar.";
      }

      function render(){
        const payload = getPayload();
        const { doneCount, totalSteps, percent } = getProgress(payload);
        const currentStep = steps[currentStepIndex];
        if (!currentStep) return;

        progressMetaEl.textContent = doneCount + "/" + totalSteps + " etapas concludas";
        progressFillEl.style.width = percent + "%";
        progressPercentEl.textContent = percent + "%";
        statusEl.textContent = getStatusMessage(doneCount, totalSteps);

        indicatorsEl.innerHTML = steps.map((step, index) => {
          const classes = ["onboarding-step-dot"];
          if (payload[step.key]) classes.push("is-done");
          if (index === currentStepIndex) classes.push("is-active");
          return '<span class="' + classes.join(" ") + '"></span>';
        }).join("");

        currentStepCheckboxEl.dataset.stepKey = currentStep.key;
        currentStepCheckboxEl.checked = Boolean(payload[currentStep.key]);
        currentStepLabelEl.textContent = currentStep.label || ("Etapa " + (currentStepIndex + 1));
        if (currentStepIndex >= totalSteps - 1) {
          currentStepHintEl.textContent = "ltima etapa: marque esta confirmao e clique em Confirmar e salvar.";
        } else {
          currentStepHintEl.textContent = "Etapa " + (currentStepIndex + 1) + " de " + totalSteps + ". Marque e clique em Prosseguir.";
        }

        prevBtn.disabled = currentStepIndex <= 0 || isSaving;
        nextBtn.hidden = currentStepIndex >= totalSteps - 1;
        nextBtn.disabled = !payload[currentStep.key] || isSaving;
        confirmBtn.hidden = currentStepIndex < totalSteps - 1;
        confirmBtn.disabled = doneCount < totalSteps || isSaving;
      }

      async function saveProgress(){
        const localPayload = getPayload();
        const progress = getProgress(localPayload);
        if (progress.doneCount < progress.totalSteps) {
          setSaveMessage("Conclua todas as etapas antes de confirmar.", true);
          return;
        }

        isSaving = true;
        render();
        const seq = ++saveSeq;
        setSaveMessage("Confirmando e salvando checklist...", false);

        try {
          const response = await fetch(endpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRF-Token": csrfToken
            },
            credentials: "same-origin",
            body: JSON.stringify({
              steps: localPayload
            })
          });
          const data = await response.json().catch(() => ({}));

          if (seq !== saveSeq) return;
          if (!response.ok || !data.ok) {
            throw new Error("save_failed");
          }

          const savedSteps = (data && typeof data.steps === "object" && data.steps) ? data.steps : localPayload;
          steps.forEach((step) => {
            stepState[step.key] = Boolean(savedSteps[step.key]);
          });

          const savedProgress = getProgress(stepState);
          if (savedProgress.percent >= 100) {
            setDoneSummary(savedProgress.doneCount, savedProgress.totalSteps);
            setCompletedView(true);
          } else {
            currentStepIndex = findCurrentStepIndex(stepState);
            setCompletedView(false);
            render();
            setSaveMessage("Checklist salvo com sucesso.", false);
          }
        } catch (_) {
          if (seq !== saveSeq) return;
          setSaveMessage("Falha ao salvar. Tente novamente.", true);
        } finally {
          isSaving = false;
          if (!flowContent.hidden) render();
        }
      }

      currentStepCheckboxEl.addEventListener("change", () => {
        const stepKey = (currentStepCheckboxEl.dataset.stepKey || "").trim();
        if (!stepKey) return;
        stepState[stepKey] = Boolean(currentStepCheckboxEl.checked);
        setSaveMessage("", false);
        render();
      });

      prevBtn.addEventListener("click", () => {
        if (currentStepIndex <= 0 || isSaving) return;
        currentStepIndex -= 1;
        setSaveMessage("", false);
        render();
      });

      nextBtn.addEventListener("click", () => {
        if (isSaving) return;
        const step = steps[currentStepIndex];
        if (!step) return;
        if (!stepState[step.key]) {
          setSaveMessage("Marque a etapa atual antes de prosseguir.", true);
          return;
        }
        if (currentStepIndex < steps.length - 1) {
          currentStepIndex += 1;
          setSaveMessage("", false);
          render();
        }
      });

      confirmBtn.addEventListener("click", () => {
        if (isSaving) return;
        saveProgress();
      });

      if (isInitiallyComplete) {
        const initialProgress = getProgress(stepState);
        setDoneSummary(initialProgress.doneCount, initialProgress.totalSteps);
        setCompletedView(true);
        return;
      }

      setCompletedView(false);
      render();
    })();
  </script>
  <script>
    (function setupAccountSections(){
      const menu = document.querySelector(".account-menu");
      if (!menu) return;

      const links = Array.from(menu.querySelectorAll('a[href^="#"]'));
      if (!links.length) return;

      const sections = Array.from(document.querySelectorAll(".section-anchor"));
      const sectionById = new Map();
      sections.forEach((section) => {
        if (!section.id) return;
        sectionById.set(section.id, section);
      });
      if (!sectionById.size) return;

      const firstAvailableId = links
        .map((link) => (link.getAttribute("href") || "").replace("#", ""))
        .find((id) => sectionById.has(id)) || "resumo";

      function setActiveSection(targetId){
        const activeId = sectionById.has(targetId) ? targetId : firstAvailableId;

        sectionById.forEach((section, id) => {
          const isActive = id === activeId;
          section.classList.toggle("is-hidden", !isActive);
          section.setAttribute("aria-hidden", isActive ? "false" : "true");
        });

        links.forEach((link) => {
          const linkId = (link.getAttribute("href") || "").replace("#", "");
          const isActive = linkId === activeId;
          link.classList.toggle("is-active", isActive);
          if (isActive){
            link.setAttribute("aria-current", "page");
          } else {
            link.removeAttribute("aria-current");
          }
        });
      }

      links.forEach((link) => {
        link.addEventListener("click", (event) => {
          event.preventDefault();
          const targetId = (link.getAttribute("href") || "").replace("#", "");
          setActiveSection(targetId);
          if (window.history && window.history.replaceState){
            window.history.replaceState(null, "", `#${targetId}`);
          } else {
            window.location.hash = targetId;
          }
        });
      });

      const hashId = (window.location.hash || "").replace("#", "");
      setActiveSection(hashId || firstAvailableId);
    })();
  </script>
  <script>
    (function setupDiagnosticPrompt(){
      const card = document.getElementById("diagnosticPromptCard");
      const laterBtn = document.getElementById("diagnosticLaterBtn");
      const laterMsg = document.getElementById("diagnosticLaterMsg");
      if (!card || !laterBtn || !laterMsg) return;

      laterBtn.addEventListener("click", () => {
        card.classList.add("is-minimized");
        laterMsg.hidden = false;
      });
    })();
  </script>
  <script>
    (function setupInstallVideo(){
      const videoWrap = document.getElementById("installVideo");
      const frame = document.getElementById("installVideoFrame");
      if (!videoWrap || !frame) return;

      const videoId = (videoWrap.dataset.videoId || "").trim();
      if (!videoId) return;

      const loadVideo = function(){
        if (videoWrap.dataset.loaded === "1") return;
        const params = new URLSearchParams({
          autoplay: "0",
          playsinline: "1",
          rel: "0",
          modestbranding: "1",
          controls: "1"
        });
        frame.src = `https://www.youtube.com/embed/${encodeURIComponent(videoId)}?${params.toString()}`;
        videoWrap.dataset.loaded = "1";
      };

      frame.addEventListener("load", () => {
        videoWrap.classList.add("is-ready");
      }, { once: true });

      if ("IntersectionObserver" in window){
        const observer = new IntersectionObserver((entries, obs) => {
          const visible = entries.some((entry) => entry.isIntersecting);
          if (!visible) return;
          loadVideo();
          obs.disconnect();
        }, { threshold: 0.2 });
        observer.observe(videoWrap);
      } else {
        loadVideo();
      }
    })();
  </script>
  <script>
    (function(){
      const wrap = document.getElementById("notifWrap");
      const toggle = document.getElementById("notifToggleBtn");
      const panel = document.getElementById("notifPanel");
      if (!wrap || !toggle || !panel) return;

      function openPanel(){
        panel.classList.add("open");
        panel.setAttribute("aria-hidden", "false");
        toggle.setAttribute("aria-expanded", "true");
      }

      function closePanel(){
        panel.classList.remove("open");
        panel.setAttribute("aria-hidden", "true");
        toggle.setAttribute("aria-expanded", "false");
      }

      toggle.addEventListener("click", function(){
        if (panel.classList.contains("open")) {
          closePanel();
        } else {
          openPanel();
        }
      });

      document.addEventListener("click", function(event){
        if (!wrap.contains(event.target)) {
          closePanel();
        }
      });

      document.addEventListener("keydown", function(event){
        if (event.key === "Escape") {
          closePanel();
        }
      });
    })();
  </script>
</body>
</html>



