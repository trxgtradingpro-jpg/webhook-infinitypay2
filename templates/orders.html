{% extends "layout.html" %}
{% block title %}Pedidos{% endblock %}

{% block content %}


<!-- ================= HEADER ================= -->
<div class="header">
  <div>
    <h1>Pedidos</h1>
    <span>Lista completa de vendas realizadas</span>
  </div>
</div>

<!-- ================= FILTER BAR ================= -->
<div class="panel" style="margin-bottom:25px;">
  <h2>ğŸ” Filtros</h2>

  <div style="
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(200px,1fr));
    gap:16px;
  ">
    <input id="searchEmail" placeholder="Buscar por email"
      style="padding:12px;border-radius:10px;border:1px solid #1f2937;background:#020617;color:#e5e7eb">

    <input id="searchPlano" placeholder="Buscar por plano"
      style="padding:12px;border-radius:10px;border:1px solid #1f2937;background:#020617;color:#e5e7eb">

    <button onclick="resetFilters()"
      style="padding:12px;border-radius:10px;border:none;background:#22c55e;color:#020617;font-weight:700;cursor:pointer">
      Limpar filtros
    </button>
  </div>
</div>

<!-- ================= ORDERS TABLE ================= -->
<div class="panel">
  <h2>ğŸ“¦ Ãšltimos Pedidos</h2>

  <table class="table" id="ordersTable">
    <thead>
      <tr>
        <th>Plano</th>
        <th>Email</th>
        <th>WhatsApp</th>
        <th>Data</th>
        <th>AÃ§Ãµes</th>
      </tr>
    </thead>

    <tbody>
      {% for plano, email, telefone, created_at in orders %}
      <tr>
        <td><strong>{{ plano }}</strong></td>
        <td>{{ email }}</td>
        <td>{{ telefone }}</td>
        <td>{{ created_at }}</td>
        <td>
          <button onclick="reenviar('{{ email }}')"
            style="
              padding:8px 12px;
              border-radius:8px;
              border:none;
              background:#38bdf8;
              color:#020617;
              font-weight:600;
              cursor:pointer">
            Reenviar
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ================= FOOTER ================= -->
<div class="footer">
  Â© 2026 TRX Trading â€¢ Pedidos
</div>

<!-- ================= JS ================= -->
<script>
function resetFilters() {
  document.getElementById("searchEmail").value = "";
  document.getElementById("searchPlano").value = "";
  filterTable();
}

function filterTable() {
  const emailFilter = document.getElementById("searchEmail").value.toLowerCase();
  const planoFilter = document.getElementById("searchPlano").value.toLowerCase();
  const rows = document.querySelectorAll("#ordersTable tbody tr");

  rows.forEach(row => {
    const email = row.children[1].innerText.toLowerCase();
    const plano = row.children[0].innerText.toLowerCase();

    const show =
      email.includes(emailFilter) &&
      plano.includes(planoFilter);

    row.style.display = show ? "" : "none";
  });
}

document.getElementById("searchEmail").addEventListener("input", filterTable);
document.getElementById("searchPlano").addEventListener("input", filterTable);

function reenviar(email) {
  alert("ğŸ” Reenvio de email para:\n\n" + email + "\n\n(aÃ§Ã£o simulada)");
}
</script>

{% endblock %}

